<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J.A.R.V.I.S.I. Just A Really Versatile, Insightful & Soft Intelligence </title>
    
    <!-- 
    =================================================================
    üéØ FUI TEMPLATE USAGE GUIDE - FUIÊ®°Êùø‰ΩøÁî®ÊåáÂçó
    =================================================================
    
    üìñ Ê®°ÊùøËØ¥ÊòéÔºö
    ËøôÊòØ‰∏Ä‰∏™Áî®‰∫é3DÁêÉÁä∂ÁïåÈù¢ÁöÑLLMÂÜÖÂÆπÁîüÊàêÊ®°Êùø„ÄÇ‰∏ªË¶ÅÁî®‰∫éÂø´ÈÄüÊõøÊç¢ÂÜÖÂÆπËÄåÊó†ÈúÄÈáçÊñ∞ÁîüÊàêÊï¥‰∏™ÁïåÈù¢‰ª£Á†Å„ÄÇ
    
    üîÑ ‰∏ªË¶ÅÊõøÊç¢Âå∫ÂüüÔºö
    1. DYNAMIC CONTENT ZONE (Âä®ÊÄÅÂÜÖÂÆπÂå∫Âüü)
       - ‰ΩçÁΩÆÔºöJavaScript ‰∏≠ÁöÑ contentTemplates Êï∞ÁªÑ
       - ÂÜÖÂÆπÔºöÂç°ÁâáÊ†áÈ¢òÂíåÂÜÖÂÆπ
       - Ê†ºÂºèÔºö{ title: 'xxx', content: () => `htmlÂÜÖÂÆπ` }
    
    ‚öôÔ∏è ÂèØÈÄâÈÖçÁΩÆÔºö
    1. Âç°ÁâáÊï∞ÈáèÔºöËá™Âä®Ê†πÊçÆcontentTemplatesÊï∞ÁªÑÈïøÂ∫¶Á°ÆÂÆö
    2. ÂÜÖÂÆπÊõ¥Êñ∞Èó¥ÈöîÔºöinitÂáΩÊï∞‰∏≠ÁöÑsetIntervalÊó∂Èó¥
    
    üé® ÂÜÖÂÆπÊ†∑ÂºèÊåáÂçóÔºö
    - ÊîØÊåÅHTMLÊ†áÁ≠æÔºö<p>, <span>, <br> Á≠â
    - ÂèØÁî®CSSÁ±ªÔºö.text-green-400, .code-string, .font-bold Á≠â
    - ÊîØÊåÅÂä®ÊÄÅJSÂèòÈáèÔºö${Date.now()}, ${Math.random()} Á≠â
    - Êé®Ëçê‰ΩøÁî®Ë°®ÊÉÖÁ¨¶Âè∑ÂíåÁâπÊÆäÂ≠óÁ¨¶Â¢ûÂº∫ËßÜËßâÊïàÊûú
    
    ‚ùå ‰∏çÂª∫ËÆÆ‰øÆÊîπÁöÑÂå∫ÂüüÔºö
    - CSSÊ†∑ÂºèÂÆö‰πâ
    - JavaScriptÂáΩÊï∞ÈÄªËæë
    - HTMLÁªìÊûÑÊ°ÜÊû∂
    - Áâ©ÁêÜÂíåÂä®ÁîªÂèÇÊï∞
    
    =================================================================
    -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;500&family=Teko:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
        }
        
        html {
            margin: 0;
            padding: 0;
            background: rgb(0, 0, 0) !important;
        }
        
        :root {
            --fui-primary: #a7d5ff;
            --fui-secondary: #ffa500;
            --fui-bg: #03080f;
            --fui-panel-bg: rgba(15, 35, 60, 0.5);
            --fui-border-color: rgba(135, 206, 250, 0.3);
            
            /* Highlight Colors */
            --highlight-color-pink: #EC4899;
            --highlight-color-blue: #3B82F6;
            --highlight-color-yellow: #FBBF24;
            --highlight-bg-pink: rgba(236, 72, 153, 0.15);
            --highlight-border-pink: rgba(236, 72, 153, 0.6);
            --highlight-bg-blue: rgba(59, 130, 246, 0.15);
            --highlight-border-blue: rgba(59, 130, 246, 0.6);
            --highlight-bg-yellow: rgba(251, 191, 36, 0.15);
            --highlight-border-yellow: rgba(251, 191, 36, 0.6);
        }

        body {
            background-color: rgb(8, 20, 35) !important;
            background-image: radial-gradient(circle at center, rgb(15, 35, 60) 0%, rgb(12, 28, 50) 60%, rgb(8, 20, 35) 85%, rgb(3, 8, 15) 100%) !important;
            color: var(--fui-primary);
            font-family: 'Roboto Mono', monospace;
            overflow: hidden;
            cursor: grab;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
        }
        .perspective-container {
            width: 100%;
            height: 100%;
            perspective: 2500px;
            position: absolute;
            transform-style: preserve-3d;
        }
        .scene-origin {
            width: 100%;
            height: 100%;
            position: absolute;
            transform-style: preserve-3d;
            will-change: transform;
        }
        .fui-window {
            position: absolute;
            top: 50%; left: 50%;
            background: var(--fui-panel-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--fui-border-color);
            border-radius: 12px;
            box-shadow: 0 0 25px rgba(0, 150, 255, 0.1);
            transform-style: preserve-3d;
            transition: box-shadow 0.3s ease, border-color 0.3s ease, background 0.4s ease, opacity 0.5s ease;
            will-change: transform, background, border-color, opacity;
            user-select: none;
        }
        .fui-window.focused {
            border-color: rgba(255, 165, 0, 0.7);
            box-shadow: 0 0 35px rgba(255, 165, 0, 0.6);
            z-index: 2000 !important;
        }
        .fui-header {
            background: rgba(135, 206, 250, 0.1);
            padding: 12px 20px;
            cursor: grab;
            border-bottom: 1px solid rgba(135, 206, 250, 0.2);
            font-family: 'Teko', sans-serif;
            font-size: 1.5rem; /* 24px */
            letter-spacing: 0.05em;
        }
        .fui-content {
            padding: 20px;
            font-size: 14px;
            line-height: 1.7;
            overflow-y: auto;
            overflow-x: hidden;
            word-wrap: break-word;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 165, 0, 0.5) transparent;
        }
        .fui-content::-webkit-scrollbar {
            width: 6px;
        }
        .fui-content::-webkit-scrollbar-track {
            background: transparent;
        }
        .fui-content::-webkit-scrollbar-thumb {
            background: rgba(255, 165, 0, 0.5);
            border-radius: 3px;
        }
        .fui-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 165, 0, 0.8);
        }
        .resize-handle {
            position: absolute;
            right: 0; bottom: 0; width: 20px; height: 20px;
            cursor: se-resize; z-index: 10;
            border-bottom: 2px solid rgba(255, 165, 0, 0.5);
            border-right: 2px solid rgba(255, 165, 0, 0.5);
        }
        .controls-panel {
            position: fixed;
            top: 15px; right: 15px; background: rgba(15, 35, 60, 0.7);
            backdrop-filter: blur(10px); border: 1px solid var(--fui-border-color);
            border-radius: 8px; padding: 8px 12px; z-index: 3000;
            font-family: 'Teko', sans-serif; letter-spacing: 0.05em;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            transform-origin: top right;
        }
        
        .controls-panel.collapsed {
            width: 44px;
            height: 44px;
            padding: 8px;
            border-radius: 50%;
        }
        
        .controls-toggle-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 28px;
            height: 28px;
            background: rgba(255, 165, 0, 0.15);
            border: 1px solid rgba(255, 165, 0, 0.4);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--fui-secondary);
            transition: all 0.3s ease;
            z-index: 1;
        }
        
        .controls-toggle-btn:hover {
            background: rgba(255, 165, 0, 0.25);
            border-color: rgba(255, 165, 0, 0.7);
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 165, 0, 0.3);
        }
        
        .controls-content {
            transition: opacity 0.3s ease, visibility 0.3s ease;
            min-width: 160px;
        }
        
        .controls-panel.collapsed .controls-content {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        
        .controls-panel.collapsed .controls-toggle-btn {
            position: relative;
            top: 0;
            right: 0;
            margin: 0;
        }
        .control-label { font-size: 0.9rem; color: var(--fui-primary); }
        .control-value { font-size: 0.9rem; color: var(--fui-secondary); }
        .control-slider {
            -webkit-appearance: none; appearance: none;
            width: 100px; height: 3px; background: rgba(135, 206, 250, 0.3); outline: none;
            border-radius: 2px; transition: background 0.3s; margin-top: 2px;
        }
        .control-slider::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 14px; height: 14px; background: var(--fui-secondary);
            cursor: pointer; border-radius: 50%; border: 2px solid var(--fui-bg);
        }
        .control-slider::-moz-range-thumb {
            width: 14px; height: 14px; background: var(--fui-secondary);
            cursor: pointer; border-radius: 50%; border: 2px solid var(--fui-bg);
        }
        .code-keyword { color: #c792ea; }
        .code-string { color: #c3e88d; }
        .code-comment { color: #546e7a; }
        .code-variable { color: #82aaff; }

        /* --- Radial Menu --- */
        /* ÊöÇÊó∂Ê≥®ÈáäÊéâÂæÑÂêëËèúÂçïÂäüËÉΩ - 2024Âπ¥Êõ¥Êñ∞
        .radial-menu-container {
            position: absolute; width: 240px; height: 240px;
            pointer-events: none; opacity: 0; z-index: 50;
            clip-path: polygon(50% 50%, 50% 0%, 50% 0%);
            transition: opacity 0.4s ease-out, clip-path 0.4s cubic-bezier(0.45, 0, 0.55, 1);
        }
        .radial-menu-container.active {
            opacity: 1; pointer-events: auto;
            clip-path: polygon(50% 50%, 50% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%, 50% 0%);
        }
        .radial-menu-arc {
            position: absolute; width: 100%; height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(15, 35, 60, 0.1) 40%, rgba(135, 206, 250, 0.3) 68%, rgba(135, 206, 250, 0.5) 70%, transparent 71%);
            box-shadow: 0 0 20px rgba(135, 206, 250, 0.3) inset;
        }
        .radial-menu-item {
            position: absolute; top: 50%; left: 50%;
            margin: -18px; width: 36px; height: 36px;
            background: rgba(15, 35, 60, 0.7);
            border: 1px solid rgba(135, 206, 250, 0.5);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; color: var(--fui-primary); opacity: 0;
            transform: translate(var(--tx, 0px), var(--ty, 0px)) scale(0);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease-out, background 0.2s, border-color 0.2s;
            transition-delay: var(--delay, 0s);
        }
        .radial-menu-container.active .radial-menu-item {
            transform: translate(var(--tx, 0px), var(--ty, 0px)) scale(1);
            opacity: 1;
        }
        .radial-menu-item:hover {
            background: rgba(255, 165, 0, 0.4);
            border-color: rgba(255, 165, 0, 0.8);
            transform: translate(var(--tx, 0px), var(--ty, 0px)) scale(1.15);
        }
        */

        /* --- Marker Dots --- */
        .marker-dots {
            position: absolute; top: 15px; right: 15px;
            display: flex; gap: 8px; z-index: 20;
        }
        .marker-dot {
            width: 8px; height: 8px;
            border-radius: 50%; cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .marker-dot:hover {
            transform: scale(1.4);
            box-shadow: 0 0 6px currentColor;
        }
        .dot-pink { background-color: var(--highlight-color-pink); color: var(--highlight-color-pink);}
        .dot-blue { background-color: var(--highlight-color-blue); color: var(--highlight-color-blue);}
        .dot-yellow { background-color: var(--highlight-color-yellow); color: var(--highlight-color-yellow);}
        .fui-window.highlight-pink {
            background: var(--highlight-bg-pink) !important;
            border-color: var(--highlight-border-pink);
        }
        .fui-window.highlight-blue {
            background: var(--highlight-bg-blue) !important;
            border-color: var(--highlight-border-blue);
        }
        .fui-window.highlight-yellow {
            background: var(--highlight-bg-yellow) !important;
            border-color: var(--highlight-border-yellow);
        }

        /* --- Center Card Highlight --- */
        .fui-window.center-highlight {
            box-shadow: 0 0 25px rgba(255, 215, 0, 0.3), 0 0 50px rgba(255, 215, 0, 0.15) !important;
            border-color: rgba(255, 215, 0, 0.5) !important;
            transform-style: preserve-3d;
            animation: centerCardPulse 3s ease-in-out infinite;
        }

        @keyframes centerCardPulse {
            0%, 100% { 
                box-shadow: 0 0 25px rgba(255, 215, 0, 0.3), 0 0 50px rgba(255, 215, 0, 0.15);
            }
            50% { 
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.4), 0 0 60px rgba(255, 215, 0, 0.2);
            }
        }

        /* --- ‰∏≠ÂøÉÂÆö‰ΩçÊ†áËÆ∞ --- */
        .center-crosshair {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 60px;
            height: 60px;
            transform: translate(-50%, -50%);
            z-index: 100;
            pointer-events: none;
        }

        .crosshair-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px solid transparent;
            border-radius: 50%;
            animation: crosshairPulse 2s ease-in-out infinite;
        }

        .crosshair-ring:nth-child(1) {
            border-color: rgba(135, 206, 250, 0.8);
            animation-delay: 0s;
        }

        .crosshair-ring:nth-child(2) {
            border-color: rgba(255, 165, 0, 0.6);
            animation-delay: 0.5s;
            width: 80%;
            height: 80%;
            top: 10%;
            left: 10%;
        }

        .crosshair-ring:nth-child(3) {
            border-color: rgba(135, 206, 250, 0.4);
            animation-delay: 1s;
            width: 60%;
            height: 60%;
            top: 20%;
            left: 20%;
        }

        .crosshair-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, rgba(255, 165, 0, 0.9) 0%, rgba(135, 206, 250, 0.6) 100%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px rgba(255, 165, 0, 0.8);
            animation: centerDot 1.5s ease-in-out infinite alternate;
        }

        @keyframes crosshairPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.4;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
            }
        }

        @keyframes centerDot {
            0% {
                box-shadow: 0 0 20px rgba(255, 165, 0, 0.8);
            }
            100% {
                box-shadow: 0 0 30px rgba(255, 165, 0, 1), 0 0 50px rgba(135, 206, 250, 0.5);
            }
        }

        /* --- Holographic Light Globe --- */
        .visual-navigation {
            position: fixed;
            top: 15px;
            left: 15px;
            width: 140px;
            height: 140px;
            z-index: 3000;
            perspective: 600px;
        }
        
        .nav-globe-container {
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            position: relative;
            animation: holoGlobeFloat 6s ease-in-out infinite;
        }
        
        .nav-globe {
            width: 100px;
            height: 100px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transform-style: preserve-3d;
            border-radius: 50%;
            background: transparent;
            overflow: visible;
        }
        
        /* ÂÖ®ÊÅØÂÖâÁêÉÂ§ñÂ±Ç */
        .holo-sphere-outer {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, 
                rgba(167, 213, 255, 0.05) 0%, 
                rgba(135, 206, 250, 0.12) 30%, 
                rgba(15, 35, 60, 0.20) 60%,
                rgba(255, 165, 0, 0.08) 80%,
                transparent 100%);
            border: 2px solid rgba(135, 206, 250, 0.3);
            box-shadow: 
                0 0 35px rgba(135, 206, 250, 0.3),
                inset 0 0 25px rgba(167, 213, 255, 0.15),
                inset 0 0 50px rgba(255, 165, 0, 0.05);
            animation: holoSphereOuter 8s ease-in-out infinite;
        }
        
        /* ÂÖ®ÊÅØÂÖâÁêÉÂÜÖÂ±Ç */
        .holo-sphere-inner {
            position: absolute;
            width: 75%;
            height: 75%;
            top: 12.5%;
            left: 12.5%;
            border-radius: 50%;
            background: radial-gradient(circle, 
                rgba(167, 213, 255, 0.15) 0%, 
                rgba(135, 206, 250, 0.08) 40%, 
                rgba(255, 165, 0, 0.05) 70%,
                transparent 85%);
            border: 1px solid rgba(135, 206, 250, 0.4);
            box-shadow: 
                0 0 20px rgba(135, 206, 250, 0.2),
                inset 0 0 15px rgba(167, 213, 255, 0.1);
            animation: holoSphereInner 5s ease-in-out infinite reverse;
        }
        
        /* ÂÖâÊ≥¢Á∫πÁêÜÂ±Ç */
        .light-wave {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                transparent 0deg,
                rgba(135, 206, 250, 0.1) 45deg,
                transparent 90deg,
                rgba(167, 213, 255, 0.15) 135deg,
                transparent 180deg,
                rgba(135, 206, 250, 0.08) 225deg,
                transparent 270deg,
                rgba(167, 213, 255, 0.12) 315deg,
                transparent 360deg
            );
            animation: lightWaveRotate 12s linear infinite;
        }
        
        .light-wave::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                rgba(255, 165, 0, 0.05) 0deg,
                transparent 60deg,
                rgba(255, 165, 0, 0.1) 120deg,
                transparent 180deg,
                rgba(255, 165, 0, 0.08) 240deg,
                transparent 300deg,
                rgba(255, 165, 0, 0.06) 360deg
            );
            animation: lightWaveRotate 8s linear infinite reverse;
        }
        
        /* ËÑâÂÜ≤ÂÖâÁéØ */
        .pulse-ring {
            position: absolute;
            border-radius: 50%;
            border: 1px solid rgba(135, 206, 250, 0.4);
            animation: pulsateRing 4s ease-in-out infinite;
        }
        
        .pulse-ring:nth-child(1) {
            width: 120%;
            height: 120%;
            top: -10%;
            left: -10%;
            animation-delay: 0s;
        }
        
        .pulse-ring:nth-child(2) {
            width: 90%;
            height: 90%;
            top: 5%;
            left: 5%;
            animation-delay: 1.5s;
            border-color: rgba(255, 165, 0, 0.3);
        }
        
        .pulse-ring:nth-child(3) {
            width: 60%;
            height: 60%;
            top: 20%;
            left: 20%;
            animation-delay: 3s;
            border-color: rgba(167, 213, 255, 0.5);
        }
        
        /* ÂÖâÁÇπÔºàÂç°ÁâáÊåáÁ§∫Âô®Ôºâ */
        .nav-card-dot {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 165, 0, 0.8);
            border-radius: 50%;
            transform-style: preserve-3d;
            transition: all 0.3s ease;
            box-shadow: 
                0 0 8px rgba(255, 165, 0, 0.6),
                0 0 16px rgba(255, 165, 0, 0.3);
            animation: dotFloat 3s ease-in-out infinite;
        }
        
        .nav-card-dot.center-dot {
            width: 6px;
            height: 6px;
            background: rgba(255, 215, 0, 1);
            box-shadow: 
                0 0 12px rgba(255, 215, 0, 0.8),
                0 0 24px rgba(255, 215, 0, 0.4),
                0 0 36px rgba(255, 215, 0, 0.2);
            animation: centerDotPulse 2s ease-in-out infinite, dotFloat 3s ease-in-out infinite;
        }
        
        .nav-card-dot:hover {
            transform: scale(2);
            z-index: 10;
            box-shadow: 
                0 0 16px rgba(255, 165, 0, 1),
                0 0 32px rgba(255, 165, 0, 0.6);
        }
        
        /* Ê∑±Â∫¶Â¢ûÂº∫Â±Ç */
        .holo-depth-enhancer {
            position: absolute;
            width: 90%;
            height: 90%;
            top: 5%;
            left: 5%;
            border-radius: 50%;
            background: 
                radial-gradient(ellipse 80% 60% at 25% 25%, 
                    rgba(167, 213, 255, 0.12) 0%, 
                    transparent 50%),
                radial-gradient(ellipse 60% 80% at 75% 75%, 
                    rgba(255, 165, 0, 0.08) 0%, 
                    transparent 50%);
            border: 1px solid rgba(135, 206, 250, 0.25);
            opacity: 0.8;
            animation: depthEnhancer 7s ease-in-out infinite;
        }
        
        /* ÂÖ®ÊÅØÁΩëÊ†ºÁ∫ø */
        .holo-grid {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: 
                linear-gradient(90deg, transparent 48%, rgba(135, 206, 250, 0.1) 49%, rgba(135, 206, 250, 0.1) 51%, transparent 52%),
                linear-gradient(0deg, transparent 48%, rgba(135, 206, 250, 0.1) 49%, rgba(135, 206, 250, 0.1) 51%, transparent 52%),
                radial-gradient(circle, transparent 20%, rgba(135, 206, 250, 0.05) 21%, rgba(135, 206, 250, 0.05) 22%, transparent 23%),
                radial-gradient(circle, transparent 40%, rgba(135, 206, 250, 0.05) 41%, rgba(135, 206, 250, 0.05) 42%, transparent 43%),
                radial-gradient(circle, transparent 60%, rgba(135, 206, 250, 0.05) 61%, rgba(135, 206, 250, 0.05) 62%, transparent 63%);
            animation: holoGridPulse 6s ease-in-out infinite;
        }
        
        .nav-globe-label {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Teko', sans-serif;
            font-size: 0.75rem;
            color: var(--fui-primary);
            text-align: center;
            opacity: 0.6;
            letter-spacing: 0.1em;
            text-shadow: 0 0 10px rgba(135, 206, 250, 0.5);
            animation: labelGlow 4s ease-in-out infinite;
        }
        
        /* Âä®ÁîªÂÆö‰πâ */
        @keyframes holoGlobeFloat {
            0%, 100% { transform: translateY(0px) rotateZ(0deg); }
            25% { transform: translateY(-2px) rotateZ(0.5deg); }
            50% { transform: translateY(0px) rotateZ(1deg); }
            75% { transform: translateY(2px) rotateZ(0.5deg); }
        }
        
        @keyframes holoSphereOuter {
            0%, 100% { 
                opacity: 0.3;
                transform: scale(1);
                box-shadow: 0 0 30px rgba(135, 206, 250, 0.2);
            }
            50% { 
                opacity: 0.6;
                transform: scale(1.05);
                box-shadow: 0 0 40px rgba(135, 206, 250, 0.4);
            }
        }
        
        @keyframes holoSphereInner {
            0%, 100% { 
                opacity: 0.4;
                transform: scale(1);
            }
            50% { 
                opacity: 0.7;
                transform: scale(1.1);
            }
        }
        
        @keyframes lightWaveRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes pulsateRing {
            0%, 100% { 
                opacity: 0.2;
                transform: scale(1);
            }
            50% { 
                opacity: 0.6;
                transform: scale(1.1);
            }
        }
        
        @keyframes centerDotPulse {
            0%, 100% { 
                box-shadow: 
                    0 0 12px rgba(255, 215, 0, 0.8),
                    0 0 24px rgba(255, 215, 0, 0.4);
                transform: scale(1);
            }
            50% { 
                box-shadow: 
                    0 0 20px rgba(255, 215, 0, 1),
                    0 0 40px rgba(255, 215, 0, 0.6),
                    0 0 60px rgba(255, 215, 0, 0.3);
                transform: scale(1.3);
            }
        }
        
        @keyframes dotFloat {
            0%, 100% { transform: translateZ(0px); }
            50% { transform: translateZ(5px); }
        }
        
        @keyframes holoGridPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.7; }
        }
        
        @keyframes depthEnhancer {
            0%, 100% { 
                opacity: 0.6;
                transform: scale(1) rotateZ(0deg);
            }
            25% { 
                opacity: 0.8;
                transform: scale(1.02) rotateZ(90deg);
            }
            50% { 
                opacity: 0.9;
                transform: scale(1.05) rotateZ(180deg);
            }
            75% { 
                opacity: 0.8;
                transform: scale(1.02) rotateZ(270deg);
            }
        }
        
        @keyframes labelGlow {
            0%, 100% { 
                opacity: 0.6;
                text-shadow: 0 0 10px rgba(135, 206, 250, 0.5);
            }
            50% { 
                opacity: 0.9;
                text-shadow: 0 0 20px rgba(135, 206, 250, 0.8);
            }
        }

        /* --- Thumbnail Navigation Styles --- */
        .thumbnail-navigation {
            position: fixed;
            bottom: 15px;
            left: 15px;
            display: flex;
            align-items: flex-end;
            z-index: 3000;
            height: 60px;
            max-width: 60%;
            gap: 8px;
        }
        
        .nav-arrow {
            width: 36px;
            height: 36px;
            background: var(--fui-panel-bg);
            border: 1px solid var(--fui-border-color);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--fui-primary);
            font-size: 16px;
            user-select: none;
        }
        
        .nav-arrow:hover {
            border-color: var(--fui-secondary);
            background: rgba(255, 165, 0, 0.1);
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 165, 0, 0.2);
        }
        
        .nav-arrow:active {
            transform: scale(0.95);
        }
        
        .nav-arrow.rotating {
            pointer-events: none;
            opacity: 0.6;
        }
        
        .thumbnail-container {
            display: flex;
            align-items: flex-end;
            height: 60px;
            overflow-x: auto;
            overflow-y: visible;
            scrollbar-width: none;
            -ms-overflow-style: none;
            flex: 1;
            min-width: 0;
        }
        .thumbnail-container::-webkit-scrollbar {
            display: none;
        }
        
        .thumbnail-card {
            width: 45px;
            height: 32px;
            background: var(--fui-panel-bg);
            border: 1px solid var(--fui-border-color);
            border-radius: 3px;
            margin-right: -12px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(8px);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            font-size: 7px;
            color: var(--fui-primary);
            opacity: 1;
            transform: translateX(0px) scale(1);
        }
        
        .thumbnail-card.slide-out {
            opacity: 0;
            transform: translateX(-60px) scale(0.8);
            pointer-events: none;
        }
        
        .thumbnail-card.slide-in {
            animation: slideInFromLeft 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        
        @keyframes slideInFromLeft {
            0% {
                opacity: 0;
                transform: translateX(-60px) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translateX(0px) scale(1);
            }
        }
        
        .thumbnail-card:hover {
            transform: translateY(-3px) scale(1.05);
            border-color: var(--fui-secondary);
            margin-right: -8px;
            z-index: 10;
        }
        
        .thumbnail-card.active {
            transform: translateY(-8px) scale(1.1);
            border-color: var(--fui-secondary);
            box-shadow: 0 3px 10px rgba(255, 165, 0, 0.4);
            margin-right: -8px;
            z-index: 15;
        }
        
        .thumbnail-header {
            background: rgba(135, 206, 250, 0.1);
            padding: 2px 4px;
            font-size: 7px;
            border-bottom: 1px solid rgba(135, 206, 250, 0.2);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .thumbnail-content {
            padding: 2px 4px;
            font-size: 6px;
            line-height: 1.2;
            flex: 1;
            overflow: hidden;
            opacity: 0.7;
        }

        /* New styles for outline panel */
        .outline-panel {
            position: fixed;
            width: 250px;
            height: 0;
            background: var(--fui-panel-bg);
            border: 1px solid var(--fui-border-color);
            border-radius: 8px;
            backdrop-filter: blur(10px);
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            transform: translateY(20px) scale(0.95);
            transform-origin: bottom left;
            z-index: 2999;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 0 rgba(255, 165, 0, 0);
        }

        .outline-panel.active {
            height: 200px;
            opacity: 1;
            transform: translateY(0px) scale(1);
            box-shadow: 0 8px 25px rgba(255, 165, 0, 0.15), 0 3px 10px rgba(15, 35, 60, 0.3);
        }

        .outline-header {
            padding: 10px 15px;
            font-family: 'Teko', sans-serif;
            font-size: 1.1rem;
            color: var(--fui-secondary);
            border-bottom: 1px solid rgba(255, 165, 0, 0.2);
            text-align: center;
            letter-spacing: 0.05em;
        }

        .outline-list {
            list-style: none;
            padding: 10px 15px;
            margin: 0;
            overflow-y: auto;
            flex-grow: 1; /* Allow list to take available height */
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 165, 0, 0.5) transparent;
        }

        .outline-list::-webkit-scrollbar {
            width: 6px;
        }
        .outline-list::-webkit-scrollbar-track {
            background: transparent;
        }
        .outline-list::-webkit-scrollbar-thumb {
            background: rgba(255, 165, 0, 0.5);
            border-radius: 3px;
        }
        .outline-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 165, 0, 0.8);
        }

        .outline-list-item {
            padding: 8px 0;
            color: var(--fui-primary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: color 0.2s ease, transform 0.2s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .outline-list-item:hover {
            color: var(--fui-secondary);
            transform: translateX(5px);
        }

        /* Adjust thumbnail-navigation for outline panel */
        .thumbnail-navigation {
            position: fixed; /* Keep fixed */
            bottom: 15px;
            left: 15px;
            display: flex;
            align-items: flex-end;
            z-index: 3000;
            height: 60px; /* Base height */
            max-width: 60%;
            gap: 8px;
            /* Add transition for width/transform if needed */
            transition: width 0.4s ease-out, transform 0.4s ease-out;
        }

        /* Remove hidden-by-outline classes as they are no longer needed */
        /* .thumbnail-container.hidden-by-outline, .nav-arrow.hidden-by-outline are removed */

        /* ===== Á≤íÂ≠êËÉåÊôØÁΩëÁªúÊïàÊûú ===== */
        .particle-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
            overflow: hidden;
        }

        .particle-canvas {
            width: 100%;
            height: 100%;
        }

        /* ===== Âè≥‰∏ãËßíJARVISÂä®ÊÄÅÊïàÊûú ===== */
        .jarvis-corner-effect {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 200px;
            z-index: 2500;
            pointer-events: none;
        }

        .jarvis-corner-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        /* 3DÂÖâÁêÉÂÆπÂô® */
        .corner-sphere-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 80px;
            border-radius: 50%;
            background: radial-gradient(ellipse at center, 
                rgba(135, 206, 250, 0.05) 0%, 
                rgba(135, 206, 250, 0.15) 40%, 
                transparent 70%);
            border: 1px solid rgba(135, 206, 250, 0.2);
            box-shadow: 0 0 20px rgba(135, 206, 250, 0.1);
        }

        .corner-sphere-canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        /* ÁßëÊäÄÂõæÊ†áÂä®Áîª */
        .corner-tech-icons {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 180px;
            height: 180px;
        }

        .corner-tech-icon {
            position: absolute;
            width: 12px;
            height: 12px;
            opacity: 0;
            color: #87CEEB;
            filter: drop-shadow(0 0 3px currentColor);
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .corner-tech-icon.corner-animate-in {
            animation: cornerIconExpandIn 0.6s ease-out forwards;
        }

        .corner-tech-icon.corner-animate-out {
            animation: cornerIconExpandOut 0.4s ease-in forwards;
        }

        @keyframes cornerIconExpandIn {
            0% {
                opacity: 0;
                transform: scale(0) rotate(0deg);
            }
            100% {
                opacity: 1;
                transform: scale(1) rotate(360deg);
            }
        }

        @keyframes cornerIconExpandOut {
            0% {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: scale(0) rotate(-360deg);
            }
        }

    </style>
</head>
<body>
    <!-- Á≤íÂ≠êËÉåÊôØÁΩëÁªú -->
    <div class="particle-background">
        <canvas class="particle-canvas" id="particleCanvas"></canvas>
    </div>

    <div id="scene" class="perspective-container">
        <div id="origin" class="scene-origin">
            <!-- Connectors will be injected here -->
        </div>
    </div>
    


    <!-- Holographic Light Globe -->
    <div class="visual-navigation">
        <div id="navGlobeContainer" class="nav-globe-container">
            <div id="navGlobe" class="nav-globe">
                <!-- ÂÖ®ÊÅØÁêÉ‰ΩìÂ±ÇÊ¨°ÁªìÊûÑ -->
                <div class="holo-sphere-outer"></div>
                <div class="holo-sphere-inner"></div>
                <div class="holo-depth-enhancer"></div>
                <div class="light-wave"></div>
                <div class="pulse-ring"></div>
                <div class="pulse-ring"></div>
                <div class="pulse-ring"></div>
                <div class="holo-grid"></div>
                <!-- Card dots will be generated dynamically -->
            </div>

        </div>
    </div>

    <div id="controls" class="controls-panel collapsed">
        <div class="controls-toggle-btn" id="controlsToggle" title="Â∏ÉÂ±ÄËÆæÁΩÆ">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 16px; height: 16px;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4" />
            </svg>
        </div>
        <div class="controls-content">
            <div class="flex items-center justify-between mb-1">
                <label for="radiusSlider" class="control-label mr-3">ÁêÉ‰ΩìÂçäÂæÑ</label>
                <span id="radiusValue" class="control-value">1.2</span>
            </div>
            <input type="range" id="radiusSlider" class="control-slider" min="0.3" max="2.5" step="0.1" value="1.2">
            <div class="flex items-center justify-between mt-2 mb-1">
                <label for="depthSlider" class="control-label mr-3">È´òÂ∫¶&Á∫µÊ∑±</label>
                <span id="depthValue" class="control-value">0.6</span>
            </div>
            <input type="range" id="depthSlider" class="control-slider" min="0.0" max="2.0" step="0.1" value="0.6">
            <div class="flex items-center justify-between mt-2 mb-1">
                <label for="scaleSlider" class="control-label mr-3">Âú∫ÊôØÁº©Êîæ</label>
                <span id="scaleValue" class="control-value">0.5</span>
            </div>
            <input type="range" id="scaleSlider" class="control-slider" min="0.3" max="2.5" step="0.1" value="0.5">
        </div>
    </div>

    <div class="thumbnail-navigation">
        <div id="outlineToggle" class="nav-arrow" title="ÊòæÁ§∫/ÈöêËóèÂ§ßÁ∫≤">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 18px; height: 18px;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
        </div>
        <div id="prevArrow" class="nav-arrow" title="‰∏ä‰∏ÄÂº†Âç°Áâá">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 18px; height: 18px;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
        </div>
        <div id="thumbnailContainer" class="thumbnail-container">
            <!-- Áº©Áï•ÂõæÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
        </div>
        <div id="nextArrow" class="nav-arrow" title="‰∏ã‰∏ÄÂº†Âç°Áâá">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="width: 18px; height: 18px;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
        </div>
    </div>

    <div id="outlinePanel" class="outline-panel">
        <div class="outline-header">Âç°ÁâáÂ§ßÁ∫≤</div>
        <ul id="outlineList" class="outline-list">
            <!-- Â§ßÁ∫≤ÂàóË°®È°πÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
        </ul>
    </div>

    <!-- Âè≥‰∏ãËßíJARVISÂä®ÊÄÅÊïàÊûú -->
    <div class="jarvis-corner-effect">
        <div class="jarvis-corner-container">
            <!-- 3DÂÖâÁêÉÂÆπÂô® -->
            <div class="corner-sphere-container">
                <canvas class="corner-sphere-canvas" id="cornerSphereCanvas" width="250" height="150"></canvas>
            </div>
            
            <!-- ÁßëÊäÄÂõæÊ†áÂä®Áîª -->
            <div class="corner-tech-icons" id="cornerTechIcons">
                <!-- ÂõæÊ†áÂ∞ÜÁî±JavaScriptÂä®ÊÄÅÁîüÊàê -->
            </div>
        </div>
    </div>

    <script>
        // =================================================================
        // ‚öôÔ∏è CONFIGURATION ZONE - ÈÖçÁΩÆÂå∫Âüü 
        // =================================================================
        // ËØ¥ÊòéÔºöËøô‰∫õÊòØ‰∏ªË¶ÅÁöÑÈÖçÁΩÆÂèÇÊï∞ÔºåÂèØ‰ª•Ê†πÊçÆÈúÄË¶ÅË∞ÉÊï¥
        // LLMÊõøÊç¢ÊåáÂçóÔºö
        // - Âç°ÁâáÊï∞ÈáèÁé∞Âú®ÂÆåÂÖ®Áî±contentTemplatesÊï∞ÁªÑÈïøÂ∫¶Ëá™Âä®ÂÜ≥ÂÆöÔºåÊó†ÈúÄÊâãÂä®ÈÖçÁΩÆ
        // - ÂÖ∂‰ªñÂèÇÊï∞‰∏ÄËà¨‰∏çÈúÄË¶Å‰øÆÊîπÔºåÈô§ÈùûÊúâÁâπÊÆäÈúÄÊ±Ç
        // =================================================================
        
        const scene = document.getElementById('scene');
        const origin = document.getElementById('origin');

        // =================================================================
        // üîß PHYSICS & LAYOUT PARAMETERS - Áâ©ÁêÜÂíåÂ∏ÉÂ±ÄÂèÇÊï∞ 
        // =================================================================
        // ËØ¥ÊòéÔºöËøô‰∫õÂèÇÊï∞ÊéßÂà∂ÁïåÈù¢ÁöÑÁâ©ÁêÜË°å‰∏∫ÂíåËßÜËßâÂ∏ÉÂ±Ä
        // ‚ùå ‰∏çÂª∫ËÆÆ‰øÆÊîπÔºöËøô‰∫õÊòØÁªèËøáË∞É‰ºòÁöÑÂèÇÊï∞Ôºå‰øÆÊîπÂèØËÉΩÂΩ±Âìç‰∫§‰∫í‰ΩìÈ™å
        // =================================================================
        
        // Physics and animation parameters - Áâ©ÁêÜÂä®ÁîªÂèÇÊï∞
        const damping = 0.92;                    // ÈòªÂ∞ºÁ≥ªÊï∞
        const rotationFactor = 0.3;              // ÊóãËΩ¨Âõ†Â≠ê
        const springFactor = 0.04;               // ÂºπÁ∞ßÂõ†Â≠ê
        const springDamping = 0.85;              // ÂºπÁ∞ßÈòªÂ∞º
        const focusSpringFactor = 0.1;           // ËÅöÁÑ¶ÂºπÁ∞ßÂõ†Â≠ê
        const focusSpringDamping = 0.75;         // ËÅöÁÑ¶ÂºπÁ∞ßÈòªÂ∞º
        const focusScaleSpeed = 0.15;            // ËÅöÁÑ¶Áº©ÊîæÈÄüÂ∫¶

        // Layout parameters - Â∏ÉÂ±ÄÂèÇÊï∞
        let radiusFactor = 1.2;      // ÁêÉ‰ΩìÂçäÂæÑÂõ†Â≠êÔºàÂΩ±ÂìçÂç°ÁâáÂàÜÂ∏ÉËåÉÂõ¥Ôºâ
        let ySpreadFactor = 0.6;     // YËΩ¥È´òÂ∫¶ÂíåZËΩ¥Á∫µÊ∑±Âõ†Â≠ê

        // =================================================================
        // üîÑ STATE VARIABLES - Áä∂ÊÄÅÂèòÈáè 
        // =================================================================
        // ËØ¥ÊòéÔºöËøô‰∫õÊòØÁ≥ªÁªüËøêË°åÊó∂ÁöÑÁä∂ÊÄÅÂèòÈáè
        // ‚ùå ‰∏çÂª∫ËÆÆ‰øÆÊîπÔºöËøô‰∫õÊòØÂÜÖÈÉ®Áä∂ÊÄÅÁÆ°ÁêÜÔºå‰øÆÊîπÂèØËÉΩÂØºËá¥ÂäüËÉΩÂºÇÂ∏∏
        // =================================================================
        
        // Core state variables - Ê†∏ÂøÉÁä∂ÊÄÅÂèòÈáè
        let windows = [];                       // Á™óÂè£Êï∞ÁªÑ
        let thumbnails = [];                    // Áº©Áï•ÂõæÊï∞ÁªÑ
        let navGlobeDots = [];                  // ÂØºËà™ÁêÉÁÇπÊï∞ÁªÑ
        let currentCenterIndex = 0;             // ÂΩìÂâç‰∏≠ÂøÉÂç°ÁâáÁ¥¢Âºï
        let focusedWindow = null;               // ÂΩìÂâçËÅöÁÑ¶ÁöÑÁ™óÂè£
        
        // Rotation state - ÊóãËΩ¨Áä∂ÊÄÅ
        let isRotating = false;                 // ÊòØÂê¶Ê≠£Âú®ÊóãËΩ¨
        let rotationTargetIndex = -1;           // ÁõÆÊ†áÊóãËΩ¨Á¥¢Âºï
        let rotationStartTime = 0;              // ÊóãËΩ¨ÂºÄÂßãÊó∂Èó¥
        
        // Interaction state - ‰∫§‰∫íÁä∂ÊÄÅ
        let resizingWindow = null;              // Ê≠£Âú®Ë∞ÉÊï¥Â§ßÂ∞èÁöÑÁ™óÂè£
        let lastMouse = { x: 0, y: 0 };         // ÊúÄÂêéÈº†Ê†á‰ΩçÁΩÆ
        let isRotatingScene = false;            // ÊòØÂê¶Ê≠£Âú®ÊóãËΩ¨Âú∫ÊôØ
        let isResizing = false;                 // ÊòØÂê¶Ê≠£Âú®Ë∞ÉÊï¥Â§ßÂ∞è
        let sceneRotation = { x: -20, y: 30 };  // Âú∫ÊôØÊóãËΩ¨ËßíÂ∫¶
        let sceneVelocity = { x: 0, y: 0 };     // Âú∫ÊôØÊóãËΩ¨ÈÄüÂ∫¶
        let sceneScale = 0.5;                   // Âú∫ÊôØÁº©Êîæ
        let targetScale = 0.5;                  // ÁõÆÊ†áÁº©Êîæ
        // ÊöÇÊó∂Ê≥®ÈáäÊéâÂæÑÂêëËèúÂçïÁõ∏ÂÖ≥ÂèòÈáè - 2024Âπ¥Êõ¥Êñ∞
        // let longPressTimer = null;              // ÈïøÊåâÂÆöÊó∂Âô®
        // let activeMenuWindow = null;            // Ê¥ªÂä®ËèúÂçïÁ™óÂè£
        // const longPressDuration = 400;          // ÈïøÊåâÊåÅÁª≠Êó∂Èó¥(ms)
        let startDragPos = { x: 0, y: 0 };      // ÂºÄÂßãÊãñÊãΩ‰ΩçÁΩÆ

        // =================================================================
        // üîÑ DYNAMIC CONTENT ZONE - ÂèØÂä®ÊÄÅÊõøÊç¢ÁöÑÂÜÖÂÆπÂå∫Âüü
        // =================================================================
        // ËØ¥ÊòéÔºöËøô‰∏™Êï∞ÁªÑÂåÖÂê´ÊâÄÊúâÂç°ÁâáÁöÑÂÜÖÂÆπÊ®°ÊùøÔºåÊòØ‰∏ªË¶ÅÁöÑÂÜÖÂÆπÊõøÊç¢Âå∫Âüü
        // LLMÊõøÊç¢ÊåáÂçóÔºö
        // - ÂèØ‰ª•‰øÆÊîπÔºötitleÔºàÊ†áÈ¢òÔºâ„ÄÅcontentÂáΩÊï∞ÁöÑËøîÂõûÂÜÖÂÆπ
        // - ‰∏çË¶Å‰øÆÊîπÔºöÊï∞ÁªÑÁªìÊûÑ„ÄÅÂØπË±°ÁªìÊûÑ { title: '', content: () => `` }
        // - ÂÜÖÂÆπÊîØÊåÅÔºöHTMLÊ†áÁ≠æ„ÄÅCSSÁ±ªÂêç„ÄÅÂä®ÊÄÅÂèòÈáè
        // - Êï∞ÈáèË¶ÅÊ±ÇÔºöÂÆåÂÖ®Ëá™Áî±ÔºÅÊ∑ªÂä†ÊàñÂà†Èô§È°πÁõÆÔºåÂç°ÁâáÊï∞Èáè‰ºöËá™Âä®ÈÄÇÈÖç
        // =================================================================
        
        <!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Êæ≥Èó®ÂçöÂΩ©‰∏ö‚ÄúË¥üÂêëX‚ÄùÁöÑÊäïËµÑ‰ª∑ÂÄºÈáç‰º∞ÔΩú‰∫§‰∫íÁ†îÁ©∂È°µ</title>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root{
      --bg: #f7f7fb;
      --panel: #ffffff;
      --text: #1f2330;
      --muted: #5b637a;
      --primary: #4f46e5;
      --accent: #10b981;
      --warn: #f59e0b;
      --danger:#ef4444;
      --border:#e6e6ef;
      --shadow:0 6px 20px rgba(30,35,90,.08);
      --code:#0f172a;
    }
    [data-theme="dark"]{
      --bg:#0b0d14;
      --panel:#11131b;
      --text:#eef1ff;
      --muted:#a8b0c6;
      --primary:#8b8cf7;
      --accent:#34d399;
      --warn:#fbbf24;
      --danger:#f87171;
      --border:#1a1f2d;
      --shadow:0 8px 26px rgba(0,0,0,.45);
      --code:#0b1220;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text); font:14px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
    }
    a{color:var(--primary); text-decoration:none}
    a:hover{text-decoration:underline}
    .app{
      display:grid; grid-template-columns: 260px 1fr; grid-template-rows: 64px 1fr; grid-template-areas:
      "top top"
      "side main";
      min-height:100vh;
    }
    header{
      grid-area: top; position:sticky; top:0; z-index:10;
      backdrop-filter:saturate(1.2) blur(8px);
      background: color-mix(in oklab, var(--panel) 90%, transparent);
      border-bottom:1px solid var(--border);
    }
    .topbar{
      display:flex; align-items:center; gap:12px; padding:10px 16px; max-width:1400px; margin:0 auto;
    }
    .brand{
      display:flex; align-items:center; gap:10px; font-weight:700; letter-spacing:.2px;
    }
    .brand-badge{
      width:28px; height:28px; border-radius:8px; display:grid; place-items:center;
      background: radial-gradient(120% 140% at 20% 20%, var(--primary), var(--accent));
      color:white; font-size:14px; box-shadow:var(--shadow);
    }
    .top-actions{margin-left:auto; display:flex; gap:8px}
    .btn{
      border:1px solid var(--border); background:var(--panel); color:var(--text);
      padding:8px 12px; border-radius:10px; cursor:pointer; display:inline-flex; gap:8px; align-items:center;
      box-shadow:var(--shadow);
    }
    .btn:hover{border-color: color-mix(in oklab, var(--primary) 40%, var(--border))}
    .btn.primary{background:var(--primary); border-color:transparent; color:white}
    .btn.ghost{background:transparent; border-color:var(--border)}
    .btn .ic{width:16px; height:16px; display:inline-block}
    .ic svg{width:16px;height:16px;display:block}

    aside{
      grid-area: side; position:sticky; top:64px; height:calc(100vh - 64px);
      border-right:1px solid var(--border); padding:14px 12px; overflow:auto; background:var(--panel);
    }
    .toc h3{margin:8px 8px 6px; font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:.06em}
    .toc a{
      display:block; padding:8px 10px; border-radius:8px; color:var(--text);
      border:1px solid transparent;
    }
    .toc a:hover{background: color-mix(in oklab, var(--panel) 70%, var(--bg))}
    .toc a.active{border-color:var(--primary); background: color-mix(in oklab, var(--primary) 8%, transparent)}
    .toc .sub{padding-left:16px}
    main{grid-area: main; padding:24px; max-width:1100px; width:100%; margin:0 auto}
    section{
      background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:20px 18px; margin:16px 0;
      box-shadow:var(--shadow)
    }
    section header.sec{
      display:flex; align-items:center; justify-content:space-between; gap:8px; margin:-6px 0 8px;
    }
    h2{margin:6px 0 8px; font-size:22px}
    h3{margin:16px 0 8px; font-size:16px; color:var(--muted)}
    .muted{color:var(--muted)}
    .chips{display:flex; gap:8px; flex-wrap:wrap}
    .chip{font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--border); color:var(--muted); background:transparent}
    .grid{display:grid; gap:12px}
    .g-2{grid-template-columns:1fr 1fr}
    .g-3{grid-template-columns:repeat(3,1fr)}
    .card{border:1px solid var(--border); border-radius:12px; padding:12px; background: color-mix(in oklab, var(--panel) 90%, transparent)}
    .stat{display:flex; align-items:baseline; gap:8px}
    .stat .v{font-size:22px; font-weight:700}
    .stat .t{font-size:12px; color:var(--muted)}

    /* table */
    .table-wrap{overflow:auto; border:1px solid var(--border); border-radius:12px}
    table{width:100%; border-collapse:collapse; min-width:720px}
    th,td{padding:10px 12px; border-bottom:1px solid var(--border); text-align:left}
    th{background: color-mix(in oklab, var(--panel) 80%, var(--bg)); position:sticky; top:0; z-index:1; cursor:pointer}
    th.sort-asc::after{content:" ‚Üë"; color:var(--muted)}
    th.sort-desc::after{content:" ‚Üì"; color:var(--muted)}
    .table-tools{display:flex; gap:10px; align-items:center; padding:6px 2px 10px}

    /* controls */
    .ctrl{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .ctrl label{font-size:12px; color:var(--muted)}
    .input, .range{
      padding:8px 10px; border:1px solid var(--border); background:var(--panel); color:var(--text);
      border-radius:10px;
    }
    input[type="search"]{min-width:220px}
    .range{display:flex; flex-direction:column; gap:6px}
    .range input[type="range"]{width:100%}

    /* collapsible */
    details{border:1px dashed var(--border); border-radius:10px; padding:10px 12px; background: color-mix(in oklab, var(--panel) 94%, transparent)}
    details[open]{background: color-mix(in oklab, var(--panel) 88%, transparent)}
    details summary{cursor:pointer; user-select:none; font-weight:600}

    /* footer */
    footer{padding:30px 0 60px; color:var(--muted); text-align:center}

    /* print */
    @media print{
      header, aside, .top-actions, .no-print{ display:none !important; }
      main{max-width:none}
      section{break-inside: avoid}
      body{background:white}
    }
    /* small screens */
    @media (max-width: 960px){
      .app{grid-template-columns: 1fr; grid-template-areas:
      "top"
      "main";}
      aside{display:none}
      .g-2,.g-3{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="topbar">
      <div class="brand">
        <div class="brand-badge">X</div>
        <div>Êæ≥Èó®ÂçöÂΩ©‰∏ö‚ÄúË¥üÂêëX‚ÄùÈáç‰º∞ ¬∑ ‰∫§‰∫íÁ†îÁ©∂È°µ</div>
        <span class="chip">2025-08-13</span>
      </div>
      <div class="top-actions">
        <button class="btn" id="themeBtn" title="Ê∑±ÊµÖËâ≤ÂàáÊç¢">
          <span class="ic" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M21.64 13a9 9 0 1 1-10.63-10.6 1 1 0 0 1 1.11 1.45A7 7 0 1 0 19.2 13.5 1 1 0 0 1 21.64 13Z"/></svg>
          </span>
          ‰∏ªÈ¢ò
        </button>
        <button class="btn" id="printBtn" title="ÊâìÂç∞ÊàñÂØºÂá∫PDF">
          <span class="ic"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 9V2h12v7h2a2 2 0 0 1 2 2v6h-4v4H6v-4H2v-6a2 2 0 0 1 2-2h2Zm2-5v5h8V4H8Zm8 14H8v4h8v-4Z"/></svg></span>
          ÊâìÂç∞/PDF
        </button>
        <button class="btn" id="exportBtn" title="ÂØºÂá∫Êï∞ÊçÆJSON">
          <span class="ic"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 3v12.59l3.3-3.3 1.4 1.42L12 19.41 7.3 13.7l1.4-1.41 3.3 3.3V3h2zM4 21h16v-2H4v2z"/></svg></span>
          ÂØºÂá∫Êï∞ÊçÆ
        </button>
      </div>
    </div>
  </header>

  <aside>
    <nav class="toc" id="toc">
      <h3>ÁõÆÂΩï</h3>
      <!-- Âä®ÊÄÅÁîüÊàê -->
    </nav>
  </aside>

  <main id="main">
    <!-- Executive Summary -->
    <section id="exec-summary">
      <header class="sec">
        <h2>Ê†∏ÂøÉÊëòË¶ÅÔºàExecutive SummaryÔºâ</h2>
        <div class="chips">
          <span class="chip">Âº∫ÁõëÁÆ°</span>
          <span class="chip">Ê∞∏‰πÖÊÄßÊäïËµÑÁ®é</span>
          <span class="chip">ÈùûÂçöÂΩ©ROIÂÅè‰Ωé</span>
        </div>
      </header>
      <p>ÁªìËÆ∫ÔºöÊñ∞ËµåÁâåÂ∞ÜÊæ≥Èó®ÂçöÂΩ©‰∏ö‰ªé‚ÄúÈ´òËá™Áî±Â∫¶È´òÂà©Ê∂¶‚ÄùÁöÑÊ®°ÂºèÔºåÈáçÂ°ë‰∏∫<strong>È´òÁÆ°Êéß„ÄÅÈáçË¥£‰ªª„ÄÅ‰ΩéÂõûÊä•</strong>ÁöÑ‚ÄúÂáÜÂÖ¨ÂÖ±‰∫ã‰∏ö‚Äù„ÄÇË°å‰∏öËøõÂÖ•ÈïøÊúü‚ÄúË¥üÂêëX‚ÄùÈÄöÈÅìÔºöÂà©Ê∂¶Ë¢´‚ÄúÊ∞∏‰πÖÊÄßÊäïËµÑÁ®é‚Äù‰∏éÊ¥æÊÅØÁ∫¶ÊùüÂéãÈ°∂ÔºåÈáèÁ´ØÂèóÊ∏∏ÂÆ¢ÁªìÊûÑ‰∏éÊ∂àË¥πÈôçÁ∫ßÊé£ËÇò„ÄÇÁü≠ÊúüÂèØËßÅ‰∏™ËÇ° <em>alpha</em>ÔºàÂ¶ÇÁæéÈ´òÊ¢ÖÔºâÔºå‰ΩÜÈöæÊäµË°å‰∏ö <em>beta</em> ‰∏ãË°å„ÄÇ</p>
      <div class="grid g-3">
        <div class="card stat"><div class="v" id="stat-invest">1,188</div><div class="t">Êñ∞ÁâåÁÖß10Âπ¥ÂêàËÆ°ÊäïËµÑÔºà‰∫øÊæ≥Èó®ÂÖÉÔºâ</div></div>
        <div class="card stat"><div class="v" id="stat-non">1,087</div><div class="t">ÂÖ∂‰∏≠ÈùûÂçöÂΩ©Ôºà‰∫øÊæ≥Èó®ÂÖÉÔºâ</div></div>
        <div class="card stat"><div class="v" id="stat-tax">~1.6√ó</div><div class="t">ÈùûÂçöÂΩ©ÊâøËØ∫/2019Ë°å‰∏öEBITDA</div></div>
      </div>
    </section>

    <!-- Policy Timeline -->
    <section id="timeline">
      <header class="sec"><h2>ÊîøÁ≠ñÊºîÂèòÊó∂Èó¥ËΩ¥Ôºà2021‚Äî2022Ôºâ</h2></header>
      <details open>
        <summary>Â±ïÂºÄ/Êî∂Ëµ∑Êó∂Èó¥ËΩ¥Ë¶ÅÁÇπ</summary>
        <ul>
          <li><strong>2021-09-14</strong>Ôºö‰øÆÊ≥ïÂí®ËØ¢ÂêØÂä®Ôºà‰πùÂ§ßÊñπÂêëÔºöÊâπÁªôÊï∞Èáè„ÄÅÊúüÈôê„ÄÅÊîøÂ∫ú‰ª£Ë°®„ÄÅÈùûÂçöÂΩ©Á≠âÔºâ„ÄÇ</li>
          <li><strong>2022-06-21</strong>ÔºöÊñ∞„ÄäÂçöÂΩ©Ê≥ï„ÄãÔºàÁ¨¨7/2022Âè∑ÔºâÈÄöËøáÔºöÁâåÁÖßÊúüÈôêÁî±20Âπ¥ÈôçËá≥10Âπ¥„ÄÅÁ¶ÅÂâØÁâå„ÄÇ</li>
          <li><strong>2022-07-28</strong>ÔºöÂÖ¨ÂºÄÁ´ûÊäïÂêØÂä®„ÄÇ</li>
          <li><strong>2022-11-26</strong>ÔºöÂÖ≠ÂÆ∂ÂéüÊåÅÁâåËÄÖËé∑‰∏¥Êó∂Âà§Áªô„ÄÇ</li>
          <li><strong>2022-12-16</strong>ÔºöÊñ∞ÂêàÂêåÁ≠æÁΩ≤Ôºå2023-01-01Ëµ∑ÁîüÊïàÔºå10Âπ¥ÊúüÂπ∂ÊçÜÁªëÈùûÂçöÂΩ©ÊäïËµÑ„ÄÇ</li>
        </ul>
      </details>
    </section>

    <!-- Clause Comparison -->
    <section id="clauses">
      <header class="sec"><h2>Êñ∞ÊóßËµåÁâåÊ†∏ÂøÉÊù°Ê¨æÂØπÊØîÔºà‰ªéËßÑÂàôÁúãÊÑèÂõæÔºâ</h2></header>
      <div class="table-tools">
        <input class="input" type="search" placeholder="ÊêúÁ¥¢ÂÖ≥ÈîÆËØç‚Ä¶" data-table="tblClauses"/>
      </div>
      <div class="table-wrap">
        <table id="tblClauses">
          <thead>
          <tr>
            <th data-key="dim">Êù°Ê¨æÁª¥Â∫¶</th>
            <th data-key="old">ÊóßÔºà2002-2022Ôºâ</th>
            <th data-key="new">Êñ∞Ôºà2023-2032Ôºâ</th>
            <th data-key="impact">ÂΩ±Âìç‰∏éËß£ËØª</th>
          </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- MGM Alpha -->
    <section id="mgm">
      <header class="sec"><h2>ÁæéÈ´òÊ¢Ö‰∏≠ÂõΩ‚ÄúAlpha‚ÄùË°®Áé∞ÔºàÈ´òÁ´Ø‰∏≠Âú∫‰∏é‰æõÁªô‰æßÔºâ</h2></header>
      <div class="grid g-2">
        <div class="card">
          <h3>ÊîøÁ≠ñÊÄªÈáèÊéßÂà∂‰∏éÊã©‰ºòÂàÜÈÖç</h3>
          <p>ËµåÊ°å‰∏äÈôê 6,000ÔºåËßíÂ≠êÊú∫‰∏äÈôê 12,000ÔºõÂ¢ûÂáèÁî±ÊîøÂ∫ú‰æùÊçÆ‚ÄúÈùûÂçöÂΩ©/ÂõΩÈôÖÂÆ¢Ê∫êÊâøËØ∫‰∏éÊâßË°å‚ÄùÂä®ÊÄÅÂàÜÈÖç„ÄÇ</p>
          <ul class="muted">
            <li>ÁæéÈ´òÊ¢ÖËé∑ÂáÄÂ¢ûËµåÊ°åÔºàÁ§∫‰æãÊï∞ÊçÆ +198ÔºâÔºåÂ∏ÇÂú∫‰ªΩÈ¢ùÊòæËëóÊèêÂçá„ÄÇ</li>
            <li>‚ÄúÊâøËØ∫Ë¥®Èáè‚Äù‰∏é‚ÄúÊâøËØ∫ÂÖëÁé∞‚ÄùÔºû‚ÄúÂéÜÂè≤‰ªΩÈ¢ù‚Äù„ÄÇ</li>
          </ul>
        </div>
        <div class="card">
          <canvas id="chartMGMShare" height="150"></canvas>
        </div>
      </div>
    </section>

    <!-- Sands China Case -->
    <section id="sands">
      <header class="sec"><h2>ÈáëÊ≤ô‰∏≠ÂõΩÁñ´ÊÉÖÂâçÂêéË¥¢Âä°ÂØπÊØîÔºöÂà©Ê∂¶Â§©Ëä±ÊùøÁöÑÂΩ¢Êàê</h2></header>
      <div class="grid g-2">
        <div class="card">
          <h3>EBITDA Margin ÂØπÊØî</h3>
          <canvas id="chartSandsMargin" height="150"></canvas>
        </div>
        <div class="card">
          <h3>Ê¥æÊÅØ‰∏éËµÑÊú¨ÂºÄÊîØ</h3>
          <p class="muted">2025Âπ¥Ë±°ÂæÅÊÄßÊÅ¢Â§çÊ¥æÊÅØÔºàÁ§∫‰æãÔºöÊØèËÇ° 0.25 Ê∏ØÂÖÉÔºâÔºåËøú‰Ωé‰∫éÁñ´ÊÉÖÂâçÔºõ‰∏≠Êúü‰ª•ÂÆåÊàêÈùûÂçöÂΩ©ÊâøËØ∫‰∏∫ÂÖà„ÄÇ</p>
          <div class="grid">
            <div class="stat"><div class="v">36.3%</div><div class="t">2019 EBITDA Margin</div></div>
            <div class="stat"><div class="v">~32.9%</div><div class="t">2024 EBITDA MarginÔºàÁ§∫‰æãÔºâ</div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Six Operators Comparison -->
    <section id="ops">
      <header class="sec"><h2>ÂÖ≠Â§ßÂçö‰ºÅÂÖ≥ÈîÆÊåáÊ†áÊ®™ÂêëÊØîËæÉÔºàÂêéÁñ´ÊÉÖÔºâ</h2></header>
      <div class="table-tools">
        <input class="input" type="search" placeholder="ÊêúÁ¥¢ÂÖ¨Âè∏‚Ä¶" data-table="tblOps"/>
      </div>
      <div class="table-wrap">
        <table id="tblOps">
          <thead>
          <tr>
            <th data-key="name">ÂÖ¨Âè∏</th>
            <th data-key="share2019">Â∏ÇÂç† 2019</th>
            <th data-key="share2024">Â∏ÇÂç† 2024</th>
            <th data-key="share2025q1">Â∏ÇÂç† 2025Q1</th>
            <th data-key="ebitdaRec">EBITDAÊÅ¢Â§çÔºàÂØπ2019Ôºâ</th>
            <th data-key="nonCapex">ÈùûÂçöÂΩ©ÊâøËØ∫Ôºà‰∫øÊæ≥Èó®ÂÖÉÔºâ</th>
          </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Non-gaming Reality -->
    <section id="non-gaming">
      <header class="sec"><h2>ÈùûÂçöÂΩ©‰∏öÂä°ÁöÑÁé∞ÂÆû‰∏éÂõ∞Â¢É</h2></header>
      <div class="grid g-2">
        <div class="card">
          <h3>ÊóÖÂÆ¢‰∫∫ÂùáÈùûÂçöÂΩ©Ê∂àË¥πÔºàÁ§∫‰æãÂè£ÂæÑÔºâ</h3>
          <canvas id="chartSpend" height="160"></canvas>
        </div>
        <div class="card">
          <h3>ÁªìÊûÑÊÄßÂéüÂõ†</h3>
          <ul>
            <li>‰∏çËøáÂ§úÊóÖÂÆ¢Â¢ûÈïøÂø´„ÄÅ‰∫∫Âùá‰ΩéÔºåÁ®ÄÈáäÂùáÂÄºÔºõ</li>
            <li>Ê†∏ÂøÉÂÆ¢Ê∫êÂú∞‰∫∫Âùá‰∏ãÈôçÔºõ</li>
            <li>ÈùûÂçöÂΩ©È°πÁõÆ‰ª•‚ÄúÂêàËßÑ/ÂºïÊµÅ‚Äù‰∏∫‰∏ªÔºåÁã¨Á´ãROI‰Ωé„ÄÇ</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Vegas vs Macau -->
    <section id="vegas">
      <header class="sec"><h2>ÊãâÊñØÁª¥Âä†ÊñØ vs Êæ≥Èó®Ôºà‰∏çÂèØÁÆÄÂçïÂ§çÂà∂Ôºâ</h2></header>
      <div class="grid g-2">
        <div class="card">
          <h3>ÁªìÊûÑÂ∑ÆÂºÇË¶ÅÁÇπ</h3>
          <ul class="muted">
            <li>ÁõÆÁöÑÂú∞Âûã vs Âå∫ÂüüÁü≠ÈÄîÔºõ</li>
            <li>MICEÂºïÊìéÊàêÁÜü vs Âç†ÊØîÊúâÈôêÔºõ</li>
            <li>ÈÄóÁïôÊó∂ÈïøÊõ¥Èïø vs Êõ¥Áü≠Ôºõ</li>
            <li>ÈùûÂçöÂΩ©‰∏∫Âà©Ê∂¶‰∏≠ÂøÉ vs Â§ö‰∏∫ÊàêÊú¨/ÂêàËßÑ‰∏≠ÂøÉ„ÄÇ</li>
          </ul>
        </div>
        <div class="card">
          <h3>ÈùûÂçöÂΩ©Âç†ÊØîÂØπÊØîÔºàÁ§∫ÊÑèÔºâ</h3>
          <canvas id="chartMix" height="150"></canvas>
        </div>
      </div>
    </section>

    <!-- Permanent Investment Tax -->
    <section id="tax">
      <header class="sec"><h2>‚ÄúÊ∞∏‰πÖÊÄßÊäïËµÑÁ®é‚ÄùÈáèÂåñÔºàÈùûÂçöÂΩ©ÊâøËØ∫ / 2019 EBITDAÔºâ</h2></header>
      <div class="table-tools">
        <input class="input" type="search" placeholder="ÊêúÁ¥¢ÂÖ¨Âè∏‚Ä¶" data-table="tblTax"/>
      </div>
      <div class="table-wrap">
        <table id="tblTax">
          <thead>
          <tr>
            <th data-key="name">ÂÖ¨Âè∏</th>
            <th data-key="nonCapex">ÈùûÂçöÂΩ©ÊâøËØ∫Ôºà‰∫øÊæ≥Èó®ÂÖÉÔºâ</th>
            <th data-key="ebitda2019">2019 EBITDAÔºà‰∫øÊ∏ØÂÖÉÔºâ</th>
            <th data-key="multiple">ÂÄçÊï∞</th>
          </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ROI Sandbox -->
    <section id="roi">
      <header class="sec"><h2>ROI Ê≤ôÁõíÔºàÁªºËâ∫È¶Ü & ‰ºöÂ±ïÔºâ</h2></header>

      <div class="grid g-2">
        <div class="card">
          <h3>ÁªºËâ∫È¶ÜÊ®°Âûã</h3>
          <div class="grid">
            <div class="range">
              <label>Â∫ß‰ΩçÊï∞ <span id="s_seats_v"></span></label>
              <input type="range" id="s_seats" min="8000" max="20000" step="500" value="16000">
            </div>
            <div class="range">
              <label>Âπ¥Âú∫Ê¨° <span id="s_events_v"></span></label>
              <input type="range" id="s_events" min="10" max="80" step="1" value="40">
            </div>
            <div class="range">
              <label>‰∏äÂ∫ßÁéá <span id="s_occ_v"></span></label>
              <input type="range" id="s_occ" min="40" max="100" step="1" value="80">
            </div>
            <div class="range">
              <label>Âπ≥ÂùáÁ•®‰ª∑ÔºàMOPÔºâ <span id="s_price_v"></span></label>
              <input type="range" id="s_price" min="300" max="2000" step="50" value="1000">
            </div>
            <div class="range">
              <label>Ëâ∫‰∫∫/Âà∂‰ΩúÂàÜÊàêÔºà%Á•®ÊàøÔºâ <span id="s_split_v"></span></label>
              <input type="range" id="s_split" min="40" max="80" step="1" value="60">
            </div>
            <div class="range">
              <label>Ëê•ÈîÄÂç†ÊØîÔºà%Á•®ÊàøÔºâ <span id="s_mkt_v"></span></label>
              <input type="range" id="s_mkt" min="5" max="20" step="1" value="10">
            </div>
            <div class="range">
              <label>Âõ∫ÂÆöÊàêÊú¨/Âπ¥Ôºà‰∫øMOPÔºâ <span id="s_fixed_v"></span></label>
              <input type="range" id="s_fixed" min="0.2" max="2.0" step="0.05" value="0.8">
            </div>
            <div class="range">
              <label>‰∏ÄÊ¨°ÊÄßËµÑÊú¨ÂºÄÊîØÔºà‰∫øMOPÔºâ <span id="s_capex_v"></span></label>
              <input type="range" id="s_capex" min="8" max="35" step="1" value="20">
            </div>
          </div>
        </div>

        <div class="card">
          <h3>‰ºöÂ±ïÊ®°ÂûãÔºàÁÆÄÂåñÔºâ</h3>
          <div class="grid">
            <div class="range">
              <label>Âú∫È¶ÜÈù¢ÁßØÔºàÂçÉ„é°Ôºâ <span id="m_area_v"></span></label>
              <input type="range" id="m_area" min="10" max="120" step="5" value="30">
            </div>
            <div class="range">
              <label>Âπ¥Ê¥ªÂä®Â§©Êï∞ <span id="m_days_v"></span></label>
              <input type="range" id="m_days" min="30" max="280" step="10" value="120">
            </div>
            <div class="range">
              <label>Êó•ÂùáÁßüÈáëÔºà‰∏áMOPÔºâ <span id="m_rate_v"></span></label>
              <input type="range" id="m_rate" min="5" max="80" step="1" value="25">
            </div>
            <div class="range">
              <label>ËøêËê•ÊØõÂà©ÁéáÔºà%Ôºâ <span id="m_margin_v"></span></label>
              <input type="range" id="m_margin" min="0" max="30" step="1" value="8">
            </div>
            <div class="range">
              <label>Âõ∫ÂÆöÊàêÊú¨/Âπ¥Ôºà‰∫øMOPÔºâ <span id="m_fixed_v"></span></label>
              <input type="range" id="m_fixed" min="0.2" max="2.5" step="0.05" value="1.0">
            </div>
            <div class="range">
              <label>‰∏ÄÊ¨°ÊÄßËµÑÊú¨ÂºÄÊîØÔºà‰∫øMOPÔºâ <span id="m_capex_v"></span></label>
              <input type="range" id="m_capex" min="10" max="60" step="1" value="30">
            </div>
          </div>
        </div>
      </div>

      <div class="grid g-2">
        <div class="card">
          <h3>ÁªºËâ∫È¶ÜÔºöÊµãÁÆóÁªìÊûú</h3>
          <ul id="s_result" class="muted"></ul>
          <canvas id="chartShow" height="140"></canvas>
        </div>
        <div class="card">
          <h3>‰ºöÂ±ïÔºöÊµãÁÆóÁªìÊûú</h3>
          <ul id="m_result" class="muted"></ul>
          <canvas id="chartMice" height="140"></canvas>
        </div>
      </div>
      <p class="muted">ËØ¥ÊòéÔºöÊ≤ôÁõí‰∏∫Á§∫ÊÑèÊ®°ÂûãÔºåÁõÆÁöÑÂú®‰∫éÂØπÊØî‚ÄúÁõ¥Êé•Ë¥¢Âä°ÂõûÊä•‚Äù‰∏é‚ÄúÈïøÊúüÂêàËßÑ/ÂºïÊµÅ‰ª∑ÂÄº‚ÄùÁöÑÂº†ÂäõÔºå‰æø‰∫é‰Ω†Âú®Êä•Âëä‰∏≠ÊääÂÆöÊÄßËÆ∫Ëø∞‰∏éÈáèÂåñÁõ¥ËßâÁªü‰∏Ä„ÄÇ</p>
    </section>

    <!-- Sources -->
    <section id="sources">
      <header class="sec"><h2>‰ø°ÊÅØ‰∏éÂè£ÂæÑÔºàÂèØÊõøÊç¢Ôºâ</h2></header>
      <p class="muted">Êú¨È°µÊï∞ÊçÆ‰∏∫Á§∫‰æãÂè£ÂæÑÔºå‰æø‰∫éÁªìÊûÑÂåñÂ±ïÁ§∫‰∏é‰∫§‰∫í„ÄÇ‰Ω†ÂèØ‰ª•ÊääËá™Â∑±ÁöÑË°®Ê†º/Âè£ÂæÑÊõøÊç¢Âà∞ <code>datasets</code> ‰∏≠ÔºåÈ°µÈù¢‰ºöËá™Âä®Êõ¥Êñ∞Ë°®Ê†º‰∏éÂõæË°®„ÄÇ</p>
      <details>
        <summary>Â¶Ç‰ΩïÊõøÊç¢ÊàëÁöÑÊï∞ÊçÆÔºü</summary>
        <ol>
          <li>Áî®ÁºñËæëÂô®ÊâìÂºÄÊú¨Êñá‰ª∂ÔºåÊêúÁ¥¢ <code>const datasets = { ... }</code>„ÄÇ</li>
          <li>ÊåâÂ≠óÊÆµÊ≥®ÈáäÊõøÊç¢‰∏∫‰Ω†ÁöÑÊï∞ÊçÆÔºàÂçï‰Ωç‰øùÊåÅ‰∏ÄËá¥ÔºåÊàñÂú®ÊñáÊú¨‰∏≠Ê†áÊ≥®Ôºâ„ÄÇ</li>
          <li>Âà∑Êñ∞È°µÈù¢ÔºõËã•ÈúÄÂàÜ‰∫´ÈùôÊÄÅÁ®øÔºå‰ΩøÁî®‚ÄúÊâìÂç∞/PDF‚Äù„ÄÇ</li>
        </ol>
      </details>
    </section>

    <!-- Design Notes -->
    <section id="design">
      <header class="sec"><h2>ËÆæËÆ°ËØ¥ÊòéÔºö‰∏∫‰ªÄ‰πàËøôÊ†∑ÂÅöÔºü</h2></header>
      <ul>
        <li><strong>ÂèØ‰∫§‰∫í</strong>ÔºöROI Ê≤ôÁõí‰∏éÂõæË°®ËÅîÂä®ÔºåËÆ©ÁªìËÆ∫‰∏ç‰ªÖ‚ÄúÁúãËµ∑Êù•ÂØπ‚ÄùÔºåËøò‚ÄúÂä®Ëµ∑Êù•ÂØπ‚Äù„ÄÇ</li>
        <li><strong>Á≤æÁæé</strong>ÔºöÊöó/‰∫Æ‰∏ªÈ¢ò„ÄÅÊüîÂíåÈò¥ÂΩ±„ÄÅÁªü‰∏ÄÂúÜËßí‰∏éÈó¥Ë∑ùÔºå‰øùÊåÅÊäïÁ†îÂú∫ÊôØÁöÑÁ®≥ÈáçÊÑü„ÄÇ</li>
        <li><strong>ÁªÜËäÇÂ±ïÁ§∫</strong>ÔºöÁõÆÂΩïÈîöÁÇπ„ÄÅÂèØÊäòÂè†ÊÆµËêΩ„ÄÅË°®Ê†ºÊêúÁ¥¢‰∏éÊéíÂ∫èÔºåÊîØÊåÅË∑ØÊºî‰∏éÂ§çÁõò„ÄÇ</li>
        <li><strong>ÂèØÁßªÊ§ç</strong>ÔºöÈõ∂ÊûÑÂª∫„ÄÅÂçïÊñá‰ª∂„ÄÅËá™Â∏¶ÊâìÂç∞Ê†∑ÂºèÔºõÂØºÂá∫ JSON ‰æø‰∫éÂêéÁª≠ÂÅöÁúãÊùøÊàñÂñÇÁªôÊ®°Âûã„ÄÇ</li>
      </ul>
    </section>

    <footer class="muted">¬© 2025 ‰∫§‰∫íÁ†îÁ©∂È°µ ¬∑ ÂèØËá™Áî±Â§çÂà∂‰∏é‰∫åÊ¨°Âàõ‰Ωú</footer>
  </main>
</div>

<script>
  // ============== Êï∞ÊçÆÈõÜÔºàÁ§∫‰æãÔºâ ==============
  const datasets = {
    summary: { investTotal: 1188, nonGaming: 1087, taxMultiple: "~1.6√ó" },
    clauses: [
      {
        dim:"ÁªèËê•ÊúüÈôê",
        old:"ÊúÄÈïø20Âπ¥ÔºåÂèØÂª∂Èïø5Âπ¥",
        new:"Êîπ‰∏∫10Âπ¥Ôºå‰ªÖÂèØ‰æãÂ§ñÂª∂ÈïøËá≥Â§ö3Âπ¥",
        impact:"ÂõûÊî∂ÊúüÁº©Áü≠ÔºåÁª≠Áâå‰∏çÁ°ÆÂÆöÊÄßÊä¨Âçá ‚Üí ‰º∞ÂÄº‰∏≠Êû¢‰∏ãÁßª"
      },
      {
        dim:"ÁâåÁÖßÊÄßË¥®",
        old:"3‰∏ªÁâå+3ÂâØÁâåÔºàÂèØËΩ¨ÊâπÁªôÔºâ",
        new:"‰∏äÈôê6ÂÆ∂Ôºå‰∏•Á¶ÅÂâØÁâå/ËΩ¨ÊâπÁªô",
        impact:"ÂØªÁßüÁ©∫Èó¥Ê∂àÂ§±ÔºåÊîøÂ∫úÁõ¥ËææÊéßÂà∂ÂäõÂ¢ûÂº∫"
      },
      {
        dim:"ËµÑÊú¨/ÊäïËµÑ",
        old:"ÊúÄ‰ΩéËµÑÊú¨Èáë2‰∫øMOPÔºõÈùûÂçöÂΩ©Â§ö‰∏∫ÈºìÂä±ÊÄß",
        new:"ÊúÄ‰ΩéËµÑÊú¨Èáë50‰∫øMOPÔºõ10Âπ¥ÈùûÂçöÂΩ©ÊâøËØ∫>ÂçÉ‰∫ø",
        impact:"‚ÄúÊ∞∏‰πÖÊÄßÊäïËµÑÁ®é‚ÄùÈîÅÂÆöËá™Áî±Áé∞ÈáëÊµÅ"
      },
      {
        dim:"Á®éË¥ü‰∏éÊøÄÂä±",
        old:"ÂçöÂΩ©Á®é35%+ÊúÄÂ§ö4%Êã®ÂÖ• ‚âà39%",
        new:"35%+5%Êã®ÂÖ• ‚âà40%ÔºõÂ§ñÂÆ¢ÂºïÊµÅÂèØËé∑ÂáèÂÖç",
        impact:"Âêç‰πâÁ®éÂçáÔºõÂºïÂ§ñÂÆ¢‰∏∫ÈöæÂ∫¶Êõ¥È´òÁöÑÊñ∞KPI"
      },
      {
        dim:"ÁÆ°ÊéßÊùÉ",
        old:"‰∫ãÂêéÂêàËßÑ‰∏∫‰∏ª",
        new:"ÊîøÂ∫ú‰ª£Ë°®„ÄÅÈáçÂ§ßÂÜ≥Á≠ñÂÆ°Êâπ„ÄÅÊ¥æÊÅØÈôêÂà∂„ÄÅÂõΩÂÆ∂ÂÆâÂÖ®Êù°Ê¨æ",
        impact:"‚ÄúÂáÜÂÖ¨Áî®‰∫ã‰∏öÂåñ‚ÄùÔºö‰∏ªÊùÉÁõÆÊ†á‰ºòÂÖà‰∫éÂïÜ‰∏öÁõÆÊ†á"
      },
      {
        dim:"‰∏≠‰ªã/VIP",
        old:"ÂèØ‰∏é‰∏≠‰ªãÂàÜÊàê",
        new:"‰ªÖ‰Ω£Èáë„ÄÅ‰∏î‰∏ÄÂØπ‰∏ÄÂêà‰Ωú",
        impact:"È´òÂà©Ê∂¶VIPÁîüÊÄÅË¢´ÈáçÂ°ëÔºå‰∏≠Âú∫Êàê‰∏∫Ê†∏ÂøÉ"
      },
      {
        dim:"Êú¨Âú∞ÊåÅËÇ°",
        old:"‚â•10%",
        new:"ÊèêÂçáËá≥‚â•15%",
        impact:"Êú¨Âú∞Âà©ÁõäÁªëÂÆöÂä†Âº∫"
      }
    ],
    mgmShare: { labels:["2019","2024","2025Q1"], mgm:[9.5,17.2,17.5], peers:[90.5,82.8,82.5] },
    sandsMargins: { labels:["2019","2023","2024"], margin:[36.3,34.1,32.9] },
    operators: [
      { name:"ÈáëÊ≤ô‰∏≠ÂõΩ", share2019:23.7, share2024:23.1, share2025q1:22.0, ebitdaRec:"75%~80%", nonCapex:300 },
      { name:"Èì∂Ê≤≥Â®±‰πê", share2019:22.8, share2024:22.0, share2025q1:22.5, ebitdaRec:"80%~85%", nonCapex:284 },
      { name:"ÁæéÈ´òÊ¢Ö‰∏≠ÂõΩ", share2019:9.5, share2024:17.2, share2025q1:17.5, ebitdaRec:"~145%", nonCapex:167 },
      { name:"Êñ∞Êø†Âçö‰∫ö/ÂõΩÈôÖ", share2019:15.2, share2024:14.5, share2025q1:14.0, ebitdaRec:"70%~75%", nonCapex:118 },
      { name:"Ê∞∏Âà©Êæ≥Èó®", share2019:16.2, share2024:13.5, share2025q1:13.0, ebitdaRec:"70%~75%", nonCapex:177 },
      { name:"Êæ≥Â®±ÁªºÂêà/Êæ≥Âçö", share2019:14.1, share2024:13.1, share2025q1:12.5, ebitdaRec:"~90%", nonCapex:140 }
    ],
    spend: { labels:["2024","2025Q1","2025Q2"], perCapita:[2157,1989,1950] },
    mix: { labels:["Vegas ÈùûÂçöÂΩ©","Vegas ÂçöÂΩ©","Macau ÈùûÂçöÂΩ©*","Macau ÂçöÂΩ©*"], values:[63.4,36.6,38.3,61.7] },
    tax: [
      { name:"ÁæéÈ´òÊ¢Ö‰∏≠ÂõΩ", nonCapex:150, ebitda2019:62.0, multiple:2.42 },
      { name:"Êæ≥ÂçöÊéßËÇ°/Êæ≥Â®±ÁªºÂêà", nonCapex:120, ebitda2019:42.1, multiple:2.85 },
      { name:"Èì∂Ê≤≥Â®±‰πê", nonCapex:275, ebitda2019:165.0, multiple:1.67 },
      { name:"Êñ∞Êø†ÂõΩÈôÖ/Âçö‰∫ö", nonCapex:118, ebitda2019:125.0, multiple:0.94 },
      { name:"ÈáëÊ≤ô‰∏≠ÂõΩ", nonCapex:278, ebitda2019:248.7, multiple:1.12 },
      { name:"Ê∞∏Âà©Êæ≥Èó®", nonCapex:165, ebitda2019:95.7, multiple:1.72 }
    ]
  };

  // ============== Â∑•ÂÖ∑ÂáΩÊï∞ ==============
  const $ = (q, el=document)=>el.querySelector(q);
  const $$ = (q, el=document)=>Array.from(el.querySelectorAll(q));

  function downloadJSON(obj, filename="datasets.json"){
    const blob = new Blob([JSON.stringify(obj, null, 2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download=filename; a.click();
    URL.revokeObjectURL(url);
  }

  // ÊûÑÈÄ† TOC
  function buildTOC(){
    const toc = $("#toc");
    const sections = $$("main > section");
    sections.forEach(sec=>{
      const h2 = sec.querySelector("h2");
      if(!h2 || !sec.id) return;
      const a = document.createElement("a");
      a.href = `#${sec.id}`;
      a.textContent = h2.textContent;
      a.dataset.target = sec.id;
      toc.appendChild(a);
      // h3 Â≠êÈ°π
      const subs = sec.querySelectorAll("h3");
      if(subs.length){
        const wrap = document.createElement("div"); wrap.className="sub";
        subs.forEach(s=>{
          const id = s.id || (s.id = sec.id + "-" + s.textContent.trim().replace(/\s+/g,"-"));
          const sa = document.createElement("a");
          sa.href = `#${id}`;
          sa.textContent = "‚Äî " + s.textContent;
          wrap.appendChild(sa);
        });
        toc.appendChild(wrap);
      }
    });
    // È´ò‰∫ÆÂΩìÂâç
    const obs = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){
          const id = e.target.id;
          $$("#toc a").forEach(a=>a.classList.toggle("active", a.dataset.target===id));
        }
      });
    },{rootMargin:"-40% 0px -55% 0px", threshold:0});
    sections.forEach(s=>obs.observe(s));
  }

  // Ë°®Ê†ºÔºöÊ∏≤Êüì+ÊêúÁ¥¢+ÊéíÂ∫è
  function renderTable(el, rows, columns){
    const tbody = el.querySelector("tbody");
    function draw(data){
      tbody.innerHTML = data.map(r=>{
        return "<tr>" + columns.map(c => `<td>${r[c] ?? ""}</td>`).join("") + "</tr>";
      }).join("");
    }
    draw(rows);

    // ÊêúÁ¥¢
    const search = document.querySelector(`input[data-table="${el.id}"]`);
    let filtered = rows.slice();
    if(search){
      search.addEventListener("input", ()=>{
        const q = search.value.trim().toLowerCase();
        filtered = rows.filter(r => Object.values(r).some(v => String(v).toLowerCase().includes(q)));
        draw(filtered);
      });
    }
    // ÊéíÂ∫è
    el.querySelectorAll("th").forEach(th=>{
      th.addEventListener("click", ()=>{
        const key = th.dataset.key;
        const current = th.classList.contains("sort-asc") ? "asc" : th.classList.contains("sort-desc") ? "desc" : null;
        el.querySelectorAll("th").forEach(h=>h.classList.remove("sort-asc","sort-desc"));
        const next = current==="asc" ? "desc" : "asc";
        th.classList.add(next==="asc" ? "sort-asc" : "sort-desc");
        const num = (v)=> (typeof v==="number" || /^[\d\.\-]+$/.test(String(v))) ? Number(v) : NaN;
        filtered.sort((a,b)=>{
          const av = a[key], bv = b[key];
          const an = num(av), bn = num(bv);
          if(!Number.isNaN(an) && !Number.isNaN(bn)){
            return next==="asc" ? an - bn : bn - an;
          }
          return next==="asc" ? String(av).localeCompare(String(bv)) : String(bv).localeCompare(String(av));
        });
        draw(filtered);
      });
    });
  }

  // ‰∏ªÈ¢òÂàáÊç¢
  function initTheme(){
    const saved = localStorage.getItem("theme");
    if(saved) document.documentElement.setAttribute("data-theme", saved);
    $("#themeBtn").addEventListener("click", ()=>{
      const cur = document.documentElement.getAttribute("data-theme");
      const next = cur==="dark" ? "light" : "dark";
      document.documentElement.setAttribute("data-theme", next);
      localStorage.setItem("theme", next);
    });
  }

  // ÂõæË°®
  let chartMGMShare, chartSandsMargin, chartSpend, chartMix, chartShow, chartMice;

  function initCharts(){
    // MGM Â∏ÇÂç†
    chartMGMShare = new Chart($("#chartMGMShare"), {
      type:"line",
      data:{
        labels: datasets.mgmShare.labels,
        datasets:[
          { label:"MGM ‰∏≠ÂõΩ", data:datasets.mgmShare.mgm, tension:.3 },
          { label:"ÂÖ∂ÂÆÉÂêàËÆ°", data:datasets.mgmShare.peers, tension:.3 }
        ]
      },
      options:{ responsive:true, plugins:{ legend:{position:"bottom"}}, scales:{ y:{ ticks:{ callback:v=>v+"%"}}}}
    });

    // Sands margin
    chartSandsMargin = new Chart($("#chartSandsMargin"), {
      type:"bar",
      data:{ labels:datasets.sandsMargins.labels, datasets:[{label:"EBITDA Margin", data:datasets.sandsMargins.margin}]},
      options:{responsive:true, plugins:{legend:{display:false}}, scales:{ y:{ ticks:{ callback:v=>v+"%"}}}}
    });

    // Non-gaming spend
    chartSpend = new Chart($("#chartSpend"), {
      type:"bar",
      data:{ labels:datasets.spend.labels, datasets:[{label:"‰∫∫ÂùáÈùûÂçöÂΩ©Ê∂àË¥πÔºàMOPÔºâ", data:datasets.spend.perCapita}]},
      options:{responsive:true, plugins:{legend:{position:"bottom"}}}
    });

    // Mix comparison (Á§∫ÊÑè)
    chartMix = new Chart($("#chartMix"), {
      type:"doughnut",
      data:{ labels:datasets.mix.labels, datasets:[{data:datasets.mix.values}]},
      options:{responsive:true, plugins:{legend:{position:"bottom"}}}
    });
  }

  // ROI ËÆ°ÁÆó
  function fmt(num, digits=2){ return Number(num).toLocaleString(undefined,{maximumFractionDigits:digits})}
  function setText(id, val){ const el = document.getElementById(id); if(el) el.textContent = val }

  function calcShow(){
    const seats = +$("#s_seats").value;
    const events= +$("#s_events").value;
    const occ   = +$("#s_occ").value/100;
    const price = +$("#s_price").value;
    const split = +$("#s_split").value/100;
    const mkt   = +$("#s_mkt").value/100;
    const fixed = +$("#s_fixed").value * 1e8; // ‰∫øMOP ‚Üí MOP
    const capex = +$("#s_capex").value * 1e8;

    // Êî∂ÂÖ•
    const ticket = events * seats * occ * price; // MOP
    const sponsor = ticket * 0.15;
    const revenue = ticket + sponsor;

    // ÊàêÊú¨
    const artist = ticket * split;
    const marketing = ticket * mkt;
    const cost = artist + marketing + fixed;

    const ebitda = revenue - cost;
    const roi = capex>0 ? (ebitda / capex) : 0;
    const payback = ebitda>0 ? (capex / ebitda) : Infinity;

    // ÊñáÊú¨
    setText("s_seats_v", seats.toLocaleString());
    setText("s_events_v", events);
    setText("s_occ_v", Math.round(occ*100)+"%");
    setText("s_price_v", price);
    setText("s_split_v", Math.round(split*100)+"%");
    setText("s_mkt_v", Math.round(mkt*100)+"%");
    setText("s_fixed_v", $("#s_fixed").value+"");
    setText("s_capex_v", $("#s_capex").value+"");

    const ul = $("#s_result");
    ul.innerHTML = `
      <li>Á•®ÊàøÊî∂ÂÖ•Ôºö<strong>${fmt(ticket/1e8,3)}</strong> ‰∫ø MOP</li>
      <li>ËµûÂä©/ÁßüÈáëÁ≠âÔºö<strong>${fmt(sponsor/1e8,3)}</strong> ‰∫ø MOP</li>
      <li>Âπ¥Â∫¶ÊÄªÊî∂ÂÖ•Ôºö<strong>${fmt(revenue/1e8,3)}</strong> ‰∫ø MOP</li>
      <li>Âπ¥Â∫¶ÊàêÊú¨ÔºàÂê´Âõ∫ÂÆöÔºâÔºö<strong>${fmt(cost/1e8,3)}</strong> ‰∫ø MOP</li>
      <li>Âπ¥Â∫¶ EBITDAÔºö<strong>${fmt(ebitda/1e8,3)}</strong> ‰∫ø MOP</li>
      <li>ÈùôÊÄÅ ROIÔºö<strong>${fmt(roi*100,2)}%</strong></li>
      <li>ÂõûÊî∂ÊúüÔºö<strong>${(payback===Infinity?'‚àû':fmt(payback,2))}</strong> Âπ¥</li>
    `;

    // Âõæ
    const labels = ["Êî∂ÂÖ•","ÊàêÊú¨","EBITDA"];
    const values = [revenue, cost, ebitda].map(v=> +(v/1e8).toFixed(3));
    if(chartShow){ chartShow.destroy(); }
    chartShow = new Chart($("#chartShow"), {
      type:"bar",
      data:{ labels, datasets:[{label:"‰∫ø MOP", data:values}]},
      options:{responsive:true, plugins:{legend:{display:false}}}
    });
  }

  function calcMice(){
    const areaK = +$("#m_area").value; // ÂçÉ„é°
    const days  = +$("#m_days").value;
    const rateW = +$("#m_rate").value; // ‰∏á/Êó•
    const mgn   = +$("#m_margin").value/100;
    const fixed = +$("#m_fixed").value * 1e8;
    const capex = +$("#m_capex").value * 1e8;

    // ÁÆÄÂåñ‰º∞ËÆ°ÔºöÊî∂ÂÖ• ~ Èù¢ÁßØÁ≥ªÊï∞ * Â§©Êï∞ * Êó•Áßü
    // Èù¢ÁßØÁ≥ªÊï∞ÔºàÁõ∏ÂØπÔºâÔºöÊåâ 1.0 ‰∏∫ 30ÂçÉ„é° Ê†áÂáÜ
    const areaCoef = areaK/30;
    const revenue = areaCoef * days * (rateW*1e4); // MOP
    const gross = revenue * mgn;
    const ebitda = gross - fixed;
    const roi = capex>0 ? (ebitda / capex) : 0;
    const payback = ebitda>0 ? (capex / ebitda) : Infinity;

    setText("m_area_v", areaK+"");
    setText("m_days_v", days+"");
    setText("m_rate_v", rateW+"");
    setText("m_margin_v", Math.round(mgn*100)+"%");
    setText("m_fixed_v", $("#m_fixed").value+"");
    setText("m_capex_v", $("#m_capex").value+"");

    const ul = $("#m_result");
    ul.innerHTML = `
      <li>Âπ¥Â∫¶Êî∂ÂÖ•ÔºàÂú∫ÁßüÁ≠âÔºâÔºö<strong>${fmt(revenue/1e8,3)}</strong> ‰∫ø MOP</li>
      <li>ËøêËê•ÊØõÂà©Ôºö<strong>${fmt(gross/1e8,3)}</strong> ‰∫ø MOP</li>
      <li>Âπ¥Â∫¶ EBITDAÔºàÊâ£Âõ∫ÂÆöÔºâÔºö<strong>${fmt(ebitda/1e8,3)}</strong> ‰∫ø MOP</li>
      <li>ÈùôÊÄÅ ROIÔºö<strong>${fmt(roi*100,2)}%</strong></li>
      <li>ÂõûÊî∂ÊúüÔºö<strong>${(payback===Infinity?'‚àû':fmt(payback,2))}</strong> Âπ¥</li>
    `;

    if(chartMice){ chartMice.destroy(); }
    chartMice = new Chart($("#chartMice"), {
      type:"bar",
      data:{ labels:["Êî∂ÂÖ•","ÊØõÂà©","EBITDA"], datasets:[{label:"‰∫ø MOP", data:[revenue, gross, ebitda].map(v=>+(v/1e8).toFixed(3))}]},
      options:{responsive:true, plugins:{legend:{display:false}}}
    });
  }

  // ============== ÂêØÂä®Ê∏≤Êüì ==============
  function init(){
    // Ê†∏ÂøÉÊëòË¶ÅÊï∞ÂÄº
    $("#stat-invest").textContent = datasets.summary.investTotal;
    $("#stat-non").textContent = datasets.summary.nonGaming;
    $("#stat-tax").textContent = datasets.summary.taxMultiple;

    // Ë°®Ê†º
    renderTable($("#tblClauses"), datasets.clauses, ["dim","old","new","impact"]);
    renderTable($("#tblOps"), datasets.operators, ["name","share2019","share2024","share2025q1","ebitdaRec","nonCapex"]);
    renderTable($("#tblTax"), datasets.tax, ["name","nonCapex","ebitda2019","multiple"]);

    // ÂõæË°®
    initCharts();

    // ROI
    ["s_seats","s_events","s_occ","s_price","s_split","s_mkt","s_fixed","s_capex"].forEach(id=>{
      $("#"+id).addEventListener("input", calcShow);
    });
    ["m_area","m_days","m_rate","m_margin","m_fixed","m_capex"].forEach(id=>{
      $("#"+id).addEventListener("input", calcMice);
    });
    calcShow(); calcMice();

    // TOC
    buildTOC();

    // ‰∏ªÈ¢ò/ÊâìÂç∞/ÂØºÂá∫
    initTheme();
    $("#printBtn").addEventListener("click", ()=>window.print());
    $("#exportBtn").addEventListener("click", ()=>downloadJSON(datasets));

    // Âπ≥ÊªëÊªöÂä®
    document.documentElement.style.scrollBehavior = "smooth";
  }

  document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>

        
        // =================================================================
        // üìù CONTENT STYLING GUIDE - ÂÜÖÂÆπÊ†∑ÂºèÊåáÂçó
        // =================================================================
        // ÂèØÁî®ÁöÑCSSÁ±ªÂêçÔºàÂú®contentÂáΩÊï∞‰∏≠‰ΩøÁî®ÔºâÔºö
        // ÊñáÊú¨È¢úËâ≤Ôºö.text-green-400, .text-yellow-400, .text-red-400, .text-blue-400
        // ‰ª£Á†ÅÊ†∑ÂºèÔºö.code-keyword, .code-string, .code-comment, .code-variable
        // ÂÖ∂‰ªñÊ†∑ÂºèÔºö.font-bold, .animate-pulse
        // HTMLÊ†áÁ≠æÔºö<p>, <span>, <br>, Ë°®ÊÉÖÁ¨¶Âè∑Á≠â
        // 
        // Ê®°ÊùøÂÜÖÂÆπÂª∫ËÆÆÔºö
        // - ‰ΩøÁî®<p>Ê†áÁ≠æÂàÜÊÆµ
        // - Áî®<span class="xxx">‰∏∫ÈáçË¶Å‰ø°ÊÅØÊ∑ªÂä†È¢úËâ≤
        // - ÊîØÊåÅÂä®ÊÄÅJavaScriptÂèòÈáèÔºö${Date.now()}, ${Math.random()}Á≠â
        // - ÂèØ‰ª•ÂåÖÂê´Ë°®ÊÉÖÁ¨¶Âè∑„ÄÅÁâπÊÆäÂ≠óÁ¨¶Â¢ûÂº∫ËßÜËßâÊïàÊûú
        // =================================================================

        // =================================================================
        // üßÆ CORE CALCULATION FUNCTIONS - Ê†∏ÂøÉËÆ°ÁÆóÂáΩÊï∞
        // =================================================================
        // ËØ¥ÊòéÔºöËøô‰∫õÂáΩÊï∞Ë¥üË¥£3DÂ∏ÉÂ±ÄËÆ°ÁÆóÂíåÊï∞Â≠¶ËøêÁÆó
        // ‚ùå ‰∏çÂª∫ËÆÆ‰øÆÊîπÔºöËøô‰∫õÊòØÊ†∏ÂøÉÁÆóÊ≥ïÔºå‰øÆÊîπÂèØËÉΩÁ†¥Âùè3DÊïàÊûú
        // =================================================================
        
        function calculateOriginalPosition(i) {
            const radius = Math.min(window.innerWidth, window.innerHeight) * radiusFactor;
            
            // ÁêÉÁä∂ÂàÜÂ∏ÉÔºö‰øùÊåÅÁæéËßÇÁöÑÂêåÊó∂Á°Æ‰øùÂØºËà™ÂèØÈ¢ÑÊµãÊÄß
            const y = 1 - (i / (contentTemplates.length - 1)) * 2; // Y‰ªé1Âà∞-1ÁöÑÁ∫øÊÄßÂàÜÂ∏É
            const radiusAtY = Math.sqrt(1 - y * y); // Âú®ËØ•YÈ´òÂ∫¶ÁöÑÂúÜÂçäÂæÑ
            
            // Ê∑∑ÂêàÊñπÂºèÔºöÂü∫Á°ÄÂùáÂåÄÂàÜÂ∏É + ÈªÑÈáëËßíÂ∫¶ÂÅèÁßªÔºå‰øùÊåÅÁêÉÁä∂ÁæéÊÑü
            const baseAngleStep = (2 * Math.PI) / contentTemplates.length; // Âü∫Á°ÄÂùáÂåÄËßíÂ∫¶
            const goldenOffset = Math.PI * (3 - Math.sqrt(5)) * 0.3; // ËΩªÂæÆÁöÑÈªÑÈáëËßíÂ∫¶ÂÅèÁßª
            const theta = i * baseAngleStep + i * goldenOffset;
            
            // Âü∫Á°ÄÁêÉÈù¢ÂùêÊ†á
            const baseX = Math.cos(theta) * radiusAtY * radius;
            const baseZ = Math.sin(theta) * radiusAtY * radius;
            
            // YËΩ¥Â∫îÁî®Á∫µÊ∑±Âõ†Â≠ê
            const finalY = y * radius * ySpreadFactor;
            
            // ZËΩ¥Ê∑ªÂä†ÂâçÂêéÂ±ÇÊ¨°ÂèòÂåñ
            const zDepthOffset = Math.sin(i * 1.618) * radius * ySpreadFactor * 0.3;
            const finalZ = baseZ + zDepthOffset;
            
            return { x: baseX, y: finalY, z: finalZ };
        }

        // ÊöÇÊó∂Ê≥®ÈáäÊéâÂæÑÂêëËèúÂçïÂàõÂª∫ÂáΩÊï∞ - 2024Âπ¥Êõ¥Êñ∞
        /*
        function createRadialMenu() {
            // Function remains unchanged
            const menuContainer = document.createElement('div');
            menuContainer.className = 'radial-menu-container';
            const arc = document.createElement('div');
            arc.className = 'radial-menu-arc';
            menuContainer.appendChild(arc);
            const menuItems = [
                { icon: 'M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2H5a2 2 0 00-2 2v2', name: 'Analyze' },
                { icon: 'M13 10V3L4 14h7v7l9-11h-7z', name: 'Teleport' },
                { icon: 'M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z', name: 'Track' },
                { icon: 'M6 18L18 6M6 6l12 12', name: 'Close' }
            ];
            const angleStep = 180 / (menuItems.length - 1);
            const radius = 85;
            menuItems.forEach((item, index) => {
                const menuItem = document.createElement('div');
                menuItem.className = 'radial-menu-item';
                const angle = -90 + (angleStep * index);
                const rad = angle * (Math.PI / 180);
                const x = Math.cos(rad) * radius;
                const y = Math.sin(rad) * radius;
                menuItem.style.setProperty('--tx', `${x}px`);
                menuItem.style.setProperty('--ty', `${y}px`);
                menuItem.style.setProperty('--delay', `${0.15 + index * 0.06}s`);
                menuItem.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${item.icon}" /></svg>`;
                menuItem.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const winState = windows.find(w => w.el.contains(e.target));
                    console.log(`Clicked on: ${item.name} for window: ${winState ? winState.id : 'unknown'}`);
                    if (item.name === 'Close' && winState) {
                        closeWindow(winState);
                    } else {
                        hideRadialMenu();
                    }
                });
                menuContainer.appendChild(menuItem);
            });
            return menuContainer;
        }
        */

        // =================================================================
        // üèóÔ∏è UI CREATION FUNCTIONS - UIÂàõÂª∫ÂáΩÊï∞
        // =================================================================
        // ËØ¥ÊòéÔºöËøô‰∫õÂáΩÊï∞Ë¥üË¥£ÂàõÂª∫ÂíåÁÆ°ÁêÜÁïåÈù¢ÂÖÉÁ¥†
        // ‚ùå Â§ßÈÉ®ÂàÜ‰∏çÂª∫ËÆÆ‰øÆÊîπÔºöËøô‰∫õÊòØÁïåÈù¢ÁªìÊûÑÈÄªËæë
        // üîÑ ÂèØÂ∞èÂπÖË∞ÉÊï¥ÔºöÁ™óÂè£Â§ßÂ∞è„ÄÅÊ†∑ÂºèÁ±ªÂêçÁ≠âËßÜËßâÂ±ûÊÄß
        // =================================================================
        
        function createWindow(i) {
            // Function remains unchanged
            const template = contentTemplates[i % contentTemplates.length];
            const win = document.createElement('div');
            win.id = `window-${i}`;
            win.className = 'fui-window';
            let cardWidth = window.innerWidth * (Math.random() * 0.05 + 0.22);
            let cardHeight = cardWidth * 0.8;
            const originalPos = calculateOriginalPosition(i);
            
            win.innerHTML = `
                <div class="fui-header">${template.title}</div>
                <div class="marker-dots">
                    <div class="marker-dot dot-pink" data-color="pink"></div>
                    <div class="marker-dot dot-blue" data-color="blue"></div>
                    <div class="marker-dot dot-yellow" data-color="yellow"></div>
                </div>
                <div class="fui-content">...</div>
                <div class="resize-handle"></div>`;

            // ÊöÇÊó∂Ê≥®ÈáäÊéâÂæÑÂêëËèúÂçïÂàõÂª∫ - 2024Âπ¥Êõ¥Êñ∞
            // const radialMenu = createRadialMenu();
            // win.appendChild(radialMenu);
            origin.appendChild(win);

            const windowState = {
                id: win.id, el: win, 
                // radialMenu: radialMenu,  // ÊöÇÊó∂Ê≥®ÈáäÊéâÂæÑÂêëËèúÂçï - 2024Âπ¥Êõ¥Êñ∞
                width: cardWidth, height: cardHeight,
                x: originalPos.x, y: originalPos.y, z: originalPos.z, scale: 1.0,
                vx: 0, vy: 0, vz: 0,
                targetX: originalPos.x, targetY: originalPos.y, targetZ: originalPos.z,
                targetScale: 1.0,
                originalX: originalPos.x, originalY: originalPos.y, originalZ: originalPos.z,
                isFocusing: false,
                highlightColor: null
            };
            windows.push(windowState);
            updateContent(windowState);
        }

        function createNavGlobeDots() {
            // Ê∏ÖÁ©∫Áé∞ÊúâÂØºËà™ÁêÉÁÇπ
            navGlobeDots.forEach(dot => dot.el.remove());
            navGlobeDots = [];

            const navGlobe = document.getElementById('navGlobe');
            const globeRadius = 40; // ÂØºËà™ÁêÉÁöÑÂçäÂæÑÔºà100pxÁêÉ‰ΩìÁöÑ50pxÂçäÂæÑÔºâ
            
            windows.forEach((win, index) => {
                const dotEl = document.createElement('div');
                dotEl.className = 'nav-card-dot';
                
                // ËÆ°ÁÆóÂç°ÁâáÂú®ÂØºËà™ÁêÉ‰∏äÁöÑ‰ΩçÁΩÆÔºà‰ΩøÁî®‰∏é‰∏ªÂú∫ÊôØÁõ∏ÂêåÁöÑÂ∏ÉÂ±ÄÈÄªËæëÔºâ
                const y = 1 - (index / (contentTemplates.length - 1)) * 2; // Y‰ªé1Âà∞-1
                const radiusAtY = Math.sqrt(1 - y * y);
                const baseAngleStep = (2 * Math.PI) / contentTemplates.length;
                const goldenOffset = Math.PI * (3 - Math.sqrt(5)) * 0.3;
                const theta = index * baseAngleStep + index * goldenOffset;
                
                const x = Math.cos(theta) * radiusAtY * globeRadius * 0.8; // Á®çÂæÆÁº©Â∞èÔºåËÆ©ÁÇπÂú®ÁêÉ‰ΩìÂÜÖÈÉ®
                const z = Math.sin(theta) * radiusAtY * globeRadius * 0.8;
                const dotY = y * globeRadius * ySpreadFactor; // ‰∏é‰∏ªÂú∫ÊôØÁöÑySpreadFactorÂØπÂ∫î
                
                // ËÆæÁΩÆÁÇπÁöÑ‰ΩçÁΩÆ
                dotEl.style.left = `${50 + x}px`; // 50pxÊòØÁêÉÂøÉÂÅèÁßª
                dotEl.style.top = `${50 + dotY}px`;
                dotEl.style.transform = `translateX(-50%) translateY(-50%) translateZ(${z}px)`;
                dotEl.style.zIndex = Math.floor(z + 200); // Z-indexÂü∫‰∫ézÂùêÊ†áÔºåÁ°Æ‰øùÂú®ÁêÉ‰ΩìÂ±Ç‰πã‰∏ä
                
                // Ê∑ªÂä†ÈöèÊú∫Âª∂ËøüÁöÑÊµÆÂä®Âä®Áîª
                dotEl.style.animationDelay = `${index * 0.2}s`;
                
                // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂Êù•ÂØºËà™Âà∞ÂØπÂ∫îÂç°Áâá
                dotEl.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log(`ÁÇπÂáªÂÖ®ÊÅØÂØºËà™ÁÇπ ${index}`);
                    centerCardToEquator(index);
                });
                
                // Ê∑ªÂä†ÊÇ¨ÂÅúÊèêÁ§∫
                dotEl.title = contentTemplates[index % contentTemplates.length].title;
                
                navGlobe.appendChild(dotEl);
                navGlobeDots.push({ 
                    el: dotEl, 
                    index: index, 
                    x: x, 
                    y: dotY, 
                    z: z 
                });
            });
            
            updateNavGlobeStates();
        }

        function updateNavGlobeStates() {
            // Êõ¥Êñ∞ÂØºËà™ÁêÉÁÇπÁöÑÁä∂ÊÄÅ
            navGlobeDots.forEach((dot, index) => {
                if (index === currentCenterIndex) {
                    dot.el.classList.add('center-dot');
                } else {
                    dot.el.classList.remove('center-dot');
                }
            });
        }

        function updateNavGlobeRotation() {
            const navGlobe = document.getElementById('navGlobe');
            if (navGlobe) {
                // ËÆ°ÁÆóÊô∫ËÉΩÊ†°ÂáÜËßíÂ∫¶
                const adjustedRotation = calculateSmartGlobeRotation();
                navGlobe.style.transform = `translate(-50%, -50%) rotateX(${adjustedRotation.x}deg) rotateY(${adjustedRotation.y}deg)`;
            }
        }

        // Áî®‰∫éÂ≠òÂÇ®Âπ≥ÊªëËøáÊ∏°ÁöÑÁõÆÊ†áËßíÂ∫¶
        let globeTargetRotation = { x: 0, y: 0 };
        let globeCurrentRotation = { x: 0, y: 0 };
        let globeTransitionSpeed = 0.12; // ÊéßÂà∂ËøáÊ∏°Âπ≥ÊªëÂ∫¶

        function calculateSmartGlobeRotation() {
            // Âü∫Á°ÄË∑üÈöè‰∏ªÂú∫ÊôØÊóãËΩ¨
            let targetX = sceneRotation.x;
            let targetY = sceneRotation.y;
            
            // Êô∫ËÉΩÊ†°ÂáÜÔºöÂΩìÁêÉ‰ΩìÊé•Ëøë‰æßÈù¢ËßÜËßíÊó∂ËøõË°åÂæÆË∞É
            const normalizedY = ((targetY % 360) + 360) % 360;
            
            // ÂÆö‰πâÂç±Èô©ËßíÂ∫¶ËåÉÂõ¥ÔºàÊé•Ëøë‰æßÈù¢Ôºâ
            const sideViewAngles = [90, 270]; // 90Â∫¶Âíå270Â∫¶ÊòØÂÆåÂÖ®‰æßÈù¢
            const correctionRange = 30; // Âú®¬±30Â∫¶ËåÉÂõ¥ÂÜÖÂºÄÂßãÊ†°ÂáÜ
            const maxCorrection = 25; // ÊúÄÂ§ßÊ†°ÂáÜËßíÂ∫¶
            
            let isCorrectingAngle = false;
            
            for (const sideAngle of sideViewAngles) {
                const angleDiff = Math.min(
                    Math.abs(normalizedY - sideAngle),
                    Math.abs(normalizedY - sideAngle + 360),
                    Math.abs(normalizedY - sideAngle - 360)
                );
                
                if (angleDiff <= correctionRange) {
                    isCorrectingAngle = true;
                    
                    // ‰ΩøÁî®Âπ≥ÊªëÁöÑÊ†°ÂáÜÂáΩÊï∞
                    const correctionStrength = Math.sin((1 - angleDiff / correctionRange) * Math.PI / 2);
                    const correctionAmount = correctionStrength * maxCorrection;
                    
                    // Á°ÆÂÆöÊ†°ÂáÜÊñπÂêëÔºàÈÅøÂºÄ‰æßÈù¢Ôºâ
                    let correctionDirection = 1;
                    if (sideAngle === 90) {
                        correctionDirection = normalizedY < 90 ? 1 : -1;
                    } else if (sideAngle === 270) {
                        correctionDirection = normalizedY < 270 ? 1 : -1;
                    }
                    
                    // Â∫îÁî®YËΩ¥Ê†°ÂáÜ
                    targetY += correctionDirection * correctionAmount;
                    
                    // Ê∑ªÂä†Âä®ÊÄÅXËΩ¥Ë∞ÉÊï¥‰ª•Â¢ûÂº∫Á´ã‰ΩìÊÑü
                    const dynamicXCorrection = Math.sin(Date.now() * 0.001) * correctionStrength * 8;
                    const baseXCorrection = correctionStrength * 12;
                    
                    if (Math.abs(targetX) < 45) { // Âú®ÂêàÁêÜËåÉÂõ¥ÂÜÖË∞ÉÊï¥XËΩ¥
                        targetX += baseXCorrection + dynamicXCorrection;
                    }
                    
                    // Ë∞ÉÊï¥ËøáÊ∏°ÈÄüÂ∫¶ÔºöÊ†°ÂáÜÊó∂Êõ¥Âø´ÔºåÊ≠£Â∏∏Êó∂Êõ¥ÊÖ¢
                    globeTransitionSpeed = Math.min(0.25, 0.12 + correctionStrength * 0.13);
                    
                    break; // Âè™Â∫îÁî®‰∏ÄÊ¨°Ê†°ÂáÜ
                }
            }
            
            // Â¶ÇÊûúÊ≤°ÊúâÂú®Ê†°ÂáÜÔºåÊÅ¢Â§çÊ≠£Â∏∏ËøáÊ∏°ÈÄüÂ∫¶
            if (!isCorrectingAngle) {
                globeTransitionSpeed = Math.max(0.08, globeTransitionSpeed - 0.01);
            }
            
            // ÈôêÂà∂ËßíÂ∫¶ËåÉÂõ¥
            targetX = Math.max(-80, Math.min(80, targetX));
            
            // Êõ¥Êñ∞ÁõÆÊ†áËßíÂ∫¶
            globeTargetRotation.x = targetX;
            globeTargetRotation.y = targetY;
            
            // Âπ≥ÊªëËøáÊ∏°Âà∞ÁõÆÊ†áËßíÂ∫¶
            globeCurrentRotation.x += (globeTargetRotation.x - globeCurrentRotation.x) * globeTransitionSpeed;
            globeCurrentRotation.y += (globeTargetRotation.y - globeCurrentRotation.y) * globeTransitionSpeed;
            
            return { 
                x: globeCurrentRotation.x, 
                y: globeCurrentRotation.y 
            };
        }

        function createThumbnails() {
            // Ê∏ÖÁ©∫Áé∞ÊúâÁº©Áï•Âõæ
            thumbnails.forEach(t => t.el.remove());
            thumbnails = [];

            const thumbnailContainer = document.getElementById('thumbnailContainer');
            
            windows.forEach((win, index) => {
                const thumbnailEl = document.createElement('div');
                thumbnailEl.className = 'thumbnail-card';
                
                // Â¶ÇÊûúÂ§ßÁ∫≤Èù¢ÊùøÊòØÂºÄÂêØÁöÑÔºåÂàùÂßãÁä∂ÊÄÅÂ∫îËØ•ÊòØÈöêËóèÁöÑ
                if (isOutlinePanelOpen) {
                    thumbnailEl.classList.add('slide-out');
                }
                
                const template = contentTemplates[index % contentTemplates.length];
                const shortContent = template.content().replace(/<[^>]*>/g, '').substring(0, 50) + '...';
                
                thumbnailEl.innerHTML = `
                    <div class="thumbnail-header">${template.title}</div>
                    <div class="thumbnail-content">${shortContent}</div>
                `;
                
                thumbnailEl.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log(`ÁÇπÂáª‰∫ÜÁº©Áï•Âõæ ${index}`);
                    centerCardToEquator(index);
                });
                
                thumbnailContainer.appendChild(thumbnailEl);
                thumbnails.push({ 
                    el: thumbnailEl, 
                    index: index, 
                    windowState: win 
                });
            });
            
            updateThumbnailStates();
        }
        
        function closeWindow(winState) {
            if (!winState) return;
            winState.el.style.opacity = '0';
            winState.el.style.pointerEvents = 'none';
            setTimeout(() => {
                winState.el.remove();
                windows = windows.filter(w => w.id !== winState.id);
                
                if (focusedWindow && focusedWindow.id === winState.id) focusedWindow = null;
                // ÊöÇÊó∂Ê≥®ÈáäÊéâÂæÑÂêëËèúÂçïÁ™óÂè£Ê∏ÖÁêÜ - 2024Âπ¥Êõ¥Êñ∞
                // if (activeMenuWindow && activeMenuWindow.id === winState.id) activeMenuWindow = null;
                
                createThumbnails();
            }, 500);
        }

        function rotateToCard(targetIndex) {
            console.log(`Â∞ùËØïÊóãËΩ¨Âà∞Âç°Áâá ${targetIndex}, ÂΩìÂâç‰∏≠ÂøÉ: ${currentCenterIndex}`);
            
            if (targetIndex < 0 || targetIndex >= windows.length) {
                console.log('Êó†ÊïàÁöÑÁõÆÊ†áÁ¥¢Âºï');
                return;
            }
            
            // Á´ãÂç≥Êõ¥Êñ∞‰∏≠ÂøÉÁ¥¢Âºï
            currentCenterIndex = targetIndex;
            
            // ËÆæÁΩÆÊóãËΩ¨Áä∂ÊÄÅ
            isRotating = true;
            rotationTargetIndex = targetIndex;
            rotationStartTime = Date.now();
            updateNavigationState();
            
            // ‰ΩøÁî®‰∏éÂ∏ÉÂ±ÄÁõ∏ÂêåÁöÑËßíÂ∫¶ËÆ°ÁÆóÔºåÁ°Æ‰øùÂáÜÁ°ÆÂ±Ö‰∏≠
            const baseAngleStep = (2 * Math.PI) / contentTemplates.length;
            const goldenOffset = Math.PI * (3 - Math.sqrt(5)) * 0.3;
            const targetTheta = targetIndex * baseAngleStep + targetIndex * goldenOffset;
            
            // ËÆ°ÁÆóÁõÆÊ†áÂç°ÁâáÁöÑY‰ΩçÁΩÆ
            const targetY = 1 - (targetIndex / (contentTemplates.length - 1)) * 2;
            
            // ËÆ°ÁÆóÁõÆÊ†áÊóãËΩ¨ËßíÂ∫¶
            const targetYRotation = -targetTheta * (180 / Math.PI);
            const targetXRotation = -Math.asin(targetY) * (180 / Math.PI) * 1.0; // Â¢ûÂä†XËΩ¥ÊóãËΩ¨ÂπÖÂ∫¶
            
            console.log(`ÁõÆÊ†áÂç°Áâá ${targetIndex}: Y=${targetY.toFixed(3)}, targetTheta=${(targetTheta * 180/Math.PI).toFixed(1)}¬∞`);
            console.log(`ËÆ°ÁÆóÊóãËΩ¨: YËΩ¥${targetYRotation.toFixed(1)}¬∞, XËΩ¥${targetXRotation.toFixed(1)}¬∞`);
            
            // ËÆ°ÁÆóÊúÄÁü≠Ë∑ØÂæÑÁöÑËßíÂ∫¶Â∑Æ
            let yAngleDiff = targetYRotation - sceneRotation.y;
            let xAngleDiff = targetXRotation - sceneRotation.x;
            
            console.log(`ÂΩìÂâçÂú∫ÊôØ: Y=${sceneRotation.y.toFixed(1)}¬∞, X=${sceneRotation.x.toFixed(1)}¬∞`);
            console.log(`ËßíÂ∫¶Â∑Æ: ŒîY=${yAngleDiff.toFixed(1)}¬∞, ŒîX=${xAngleDiff.toFixed(1)}¬∞`);
            
            // ÈÄâÊã©ÊúÄÁü≠Ë∑ØÂæÑÊóãËΩ¨ÔºàÂ§ÑÁêÜËßíÂ∫¶Ë∑®Ë∂ä360Â∫¶ÁöÑÊÉÖÂÜµÔºâ
            while (yAngleDiff > 180) yAngleDiff -= 360;
            while (yAngleDiff < -180) yAngleDiff += 360;
            
            // Â∫îÁî®ÊóãËΩ¨
            sceneRotation.y += yAngleDiff;
            sceneRotation.x += xAngleDiff;
            
            // Ê∑ªÂä†ÊóãËΩ¨Âä®ÁîªÊïàÊûú
            sceneVelocity.y = yAngleDiff * 0.3;
            sceneVelocity.x = xAngleDiff * 0.3;
            
            // Á´ãÂç≥Êõ¥Êñ∞Áº©Áï•ÂõæÁä∂ÊÄÅ
            updateThumbnailStates();
            
            console.log(`ÊóãËΩ¨Âà∞Âç°Áâá ${targetIndex}: ËßíÂ∫¶ ${targetTheta.toFixed(2)}, YÊóãËΩ¨ ${targetYRotation.toFixed(1)}¬∞`);
            console.log(`ÊóãËΩ¨ÂêéÂú∫ÊôØ: Y=${sceneRotation.y.toFixed(1)}¬∞, X=${sceneRotation.x.toFixed(1)}¬∞`);
            
            // ÂÆåÊàêÊ£ÄÊµã
            setTimeout(() => {
                if (isRotating && rotationTargetIndex === targetIndex) {
                    isRotating = false;
                    rotationTargetIndex = -1;
                    updateNavigationState();
                    console.log(`ÊóãËΩ¨ÂÆåÊàêÂà∞Âç°Áâá ${targetIndex}`);
                }
            }, 1200);
        }

        function navigatePrevious() {
            console.log('ÂØºËà™Ôºö‰∏ä‰∏ÄÂº†Âç°Áâá');
            const prevIndex = (currentCenterIndex - 1 + windows.length) % windows.length;
            console.log(`‰ªé ${currentCenterIndex} ÂØºËà™Âà∞‰∏ä‰∏ÄÂº† ${prevIndex}`);
            centerCardToEquator(prevIndex);
        }

        function navigateNext() {
            console.log('ÂØºËà™Ôºö‰∏ã‰∏ÄÂº†Âç°Áâá');
            const nextIndex = (currentCenterIndex + 1) % windows.length;
            console.log(`‰ªé ${currentCenterIndex} ÂØºËà™Âà∞‰∏ã‰∏ÄÂº† ${nextIndex}`);
            centerCardToEquator(nextIndex);
        }

        // Âø´ÈÄüÊóãËΩ¨ÁâàÊú¨Ôºå‰∏ì‰∏∫ÈîÆÁõòÂíåÁÆ≠Â§¥ÂØºËà™‰ºòÂåñ
        function rotateToCardFast(targetIndex) {
            console.log(`Âø´ÈÄüÊóãËΩ¨Âà∞Âç°Áâá ${targetIndex}, ÂΩìÂâç‰∏≠ÂøÉ: ${currentCenterIndex}`);
            
            if (targetIndex < 0 || targetIndex >= windows.length) {
                console.log('Êó†ÊïàÁöÑÁõÆÊ†áÁ¥¢Âºï');
                return;
            }
            
            // Á´ãÂç≥Êõ¥Êñ∞‰∏≠ÂøÉÁ¥¢Âºï
            currentCenterIndex = targetIndex;
            
            // Âº∫Âà∂ÈáçÁΩÆÊóãËΩ¨Áä∂ÊÄÅ
            isRotating = false;
            rotationTargetIndex = -1;
            
            // ËÆæÁΩÆÊñ∞ÁöÑÊóãËΩ¨Áä∂ÊÄÅ
            isRotating = true;
            rotationTargetIndex = targetIndex;
            rotationStartTime = Date.now();
            updateNavigationState();
            
            // ‰ΩøÁî®‰∏éÂ∏ÉÂ±ÄÁõ∏ÂêåÁöÑËßíÂ∫¶ËÆ°ÁÆóÔºåÁ°Æ‰øùÂáÜÁ°ÆÂ±Ö‰∏≠
            const baseAngleStep = (2 * Math.PI) / contentTemplates.length;
            const goldenOffset = Math.PI * (3 - Math.sqrt(5)) * 0.3;
            const targetTheta = targetIndex * baseAngleStep + targetIndex * goldenOffset;
            
            // ËÆ°ÁÆóÁõÆÊ†áÂç°ÁâáÁöÑY‰ΩçÁΩÆ
            const targetY = 1 - (targetIndex / (contentTemplates.length - 1)) * 2;
            
            // ËÆ°ÁÆóÁõÆÊ†áÊóãËΩ¨ËßíÂ∫¶
            const targetYRotation = -targetTheta * (180 / Math.PI);
            const targetXRotation = -Math.asin(targetY) * (180 / Math.PI) * 1.0; // Â¢ûÂä†XËΩ¥ÊóãËΩ¨ÂπÖÂ∫¶
            

            
            // ËÆ°ÁÆóÊúÄÁü≠Ë∑ØÂæÑÁöÑËßíÂ∫¶Â∑Æ
            let yAngleDiff = targetYRotation - sceneRotation.y;
            let xAngleDiff = targetXRotation - sceneRotation.x;
            
            // ÈÄâÊã©ÊúÄÁü≠Ë∑ØÂæÑÊóãËΩ¨
            while (yAngleDiff > 180) yAngleDiff -= 360;
            while (yAngleDiff < -180) yAngleDiff += 360;
            
            // Â∫îÁî®ÊóãËΩ¨ÔºàÊõ¥Âø´ÁöÑÂä®ÁîªÈÄüÂ∫¶Ôºâ
            sceneRotation.y += yAngleDiff;
            sceneRotation.x += xAngleDiff;
            sceneVelocity.y = yAngleDiff * 0.5; // ÊØîÊôÆÈÄöÊóãËΩ¨Êõ¥Âø´
            sceneVelocity.x = xAngleDiff * 0.5;
            
            // Á´ãÂç≥Êõ¥Êñ∞Áº©Áï•ÂõæÁä∂ÊÄÅ
            updateThumbnailStates();
            
            console.log(`Âø´ÈÄüÊóãËΩ¨Âà∞Âç°Áâá ${targetIndex}: ËßíÂ∫¶ ${targetTheta.toFixed(2)}, YÊóãËΩ¨ ${targetYRotation.toFixed(1)}¬∞`);
            
            // Êõ¥Áü≠ÁöÑÂÆåÊàêÊ£ÄÊµãÊó∂Èó¥
            setTimeout(() => {
                if (isRotating && rotationTargetIndex === targetIndex) {
                    isRotating = false;
                    rotationTargetIndex = -1;
                    updateNavigationState();
                    console.log(`Âø´ÈÄüÊóãËΩ¨ÂÆåÊàêÂà∞Âç°Áâá ${targetIndex}`);
                }
            }, 600); // ÂáèÂ∞ëÂà∞600ms
        }

        function updateNavigationState() {
            const prevArrow = document.getElementById('prevArrow');
            const nextArrow = document.getElementById('nextArrow');
            
            if (isRotating) {
                prevArrow.classList.add('rotating');
                nextArrow.classList.add('rotating');
            } else {
                prevArrow.classList.remove('rotating');
                nextArrow.classList.remove('rotating');
            }
        }

        function checkRotationComplete() {
            if (!isRotating || rotationTargetIndex === -1) return;
            
            // Ê£ÄÊü•Âú∫ÊôØÊóãËΩ¨ÈÄüÂ∫¶ÊòØÂê¶Ë∂≥Â§üÂ∞èÔºàÊé•ËøëÈùôÊ≠¢Ôºâ
            const velocityThreshold = 0.5;
            const isNearlyStill = Math.abs(sceneVelocity.y) < velocityThreshold;
            
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÊé•ËøëÁõÆÊ†á‰ΩçÁΩÆ
            const isAtTarget = currentCenterIndex === rotationTargetIndex;
            
            if (isNearlyStill && isAtTarget) {
                // ÊóãËΩ¨ÂÆåÊàê
                isRotating = false;
                rotationTargetIndex = -1;
                updateNavigationState();
                updateThumbnailStates();
                console.log(`ÊóãËΩ¨ÂÆåÊàêÔºåÂΩìÂâç‰∏≠ÂøÉÂç°Áâá: ${currentCenterIndex}`);
            }
            
            // Â¢ûÂä†Ë∂ÖÊó∂Êú∫Âà∂ÔºåÈò≤Ê≠¢Âç°‰Ωè
            if (isRotating && Date.now() - rotationStartTime > 3000) {
                console.log('ÊóãËΩ¨Ë∂ÖÊó∂ÔºåÂº∫Âà∂ÂÆåÊàê');
                if (rotationTargetIndex !== -1) {
                    currentCenterIndex = rotationTargetIndex; // Êõ¥Êñ∞Âà∞ÁõÆÊ†áÁ¥¢Âºï
                }
                isRotating = false;
                rotationTargetIndex = -1;
                updateNavigationState();
                updateThumbnailStates();
            }
        }

        function updateThumbnailStates() {
            // Êõ¥Êñ∞Áº©Áï•ÂõæÁä∂ÊÄÅ
            thumbnails.forEach((thumbnail, index) => {
                if (index === currentCenterIndex) {
                    thumbnail.el.classList.add('active');
                } else {
                    thumbnail.el.classList.remove('active');
                }
            });
            
            // Êõ¥Êñ∞‰∏ªÁïåÈù¢Âç°ÁâáÁöÑ‰∏≠ÂøÉÈ´ò‰∫ÆÊïàÊûú
            windows.forEach((win, index) => {
                if (index === currentCenterIndex) {
                    win.el.classList.add('center-highlight');
                } else {
                    win.el.classList.remove('center-highlight');
                }
            });
            
            // ÂêåÊ≠•Êõ¥Êñ∞ÂØºËà™ÁêÉÁä∂ÊÄÅ
            updateNavGlobeStates();
        }

        function findCenterCard() {
            // Âü∫‰∫éÂçÅÂ≠óÂáÜÊòü‰ΩçÁΩÆÔºàÂ±èÂπï‰∏≠ÂøÉÔºâËøõË°åÂç°Áâá‰∏≠ÂøÉÊ£ÄÊµã
            let closestIndex = 0;
            let minDistance = Infinity;
            
            windows.forEach((win, index) => {
                // Ëé∑ÂèñÂç°ÁâáÁªèËøáÂú∫ÊôØÊóãËΩ¨ÂêéÁöÑÂÆûÈôÖ3DÂùêÊ†á
                const originalPos = calculateOriginalPosition(index);
                const rotatedPos = rotatePoint(originalPos, sceneRotation);
                
                // ËÆ°ÁÆóÂç°ÁâáÂú®Â±èÂπïÊäïÂΩ±‰∏éÂçÅÂ≠óÂáÜÊòüÁöÑË∑ùÁ¶ª
                // ÂçÅÂ≠óÂáÜÊòü‰Ωç‰∫éÂ±èÂπï‰∏≠ÂøÉ (0, 0)ÔºåËøôÈáåÊàë‰ª¨‰∏ªË¶ÅÂÖ≥Ê≥®XÂíåYÁöÑË∑ùÁ¶ª
                const distance = Math.sqrt(rotatedPos.x * rotatedPos.x + rotatedPos.y * rotatedPos.y);
                
                // Ê∑ªÂä†ZËΩ¥ÊùÉÈáçÔºåË∂äÈù†ËøëËßÇÂØüËÄÖÁöÑÂç°Áâá‰ºòÂÖàÁ∫ßË∂äÈ´ò
                const weightedDistance = distance - (rotatedPos.z * 0.001);
                
                if (weightedDistance < minDistance) {
                    minDistance = weightedDistance;
                    closestIndex = index;
                }
            });
            
            if (closestIndex !== currentCenterIndex) {
                currentCenterIndex = closestIndex;
                updateThumbnailStates();
                
                // Ê∑ªÂä†Ë∞ÉËØï‰ø°ÊÅØ
                console.log(`Center card changed to index: ${closestIndex}, title: ${contentTemplates[closestIndex].title}`);
                console.log(`Distance to crosshair: ${minDistance.toFixed(3)}`);
            }
        }

        // Êñ∞Â¢ûÔºöÁêÉ‰ΩìËµ§ÈÅìËßÜËßíÂ±Ö‰∏≠ÂáΩÊï∞
        function centerCardToEquator(targetIndex) {
            console.log(`Â∞ÜÂç°Áâá ${targetIndex} Â±Ö‰∏≠Âπ∂Ë∞ÉÊï¥Âà∞Ëµ§ÈÅìËßÜËßí`);
            
            if (targetIndex < 0 || targetIndex >= windows.length) {
                console.log('Êó†ÊïàÁöÑÁõÆÊ†áÁ¥¢Âºï');
                return;
            }
            
            // ËÆ°ÁÆóÈúÄË¶ÅÁöÑYËΩ¥ÊóãËΩ¨ËßíÂ∫¶Ôºå‰ΩøËØ•Âç°Áâá‰Ωç‰∫éÂ±èÂπï‰∏≠ÂøÉ
            const baseAngleStep = (2 * Math.PI) / contentTemplates.length;
            const goldenOffset = Math.PI * (3 - Math.sqrt(5)) * 0.3;
            const targetTheta = targetIndex * baseAngleStep + targetIndex * goldenOffset;
            
            // ÁõÆÊ†áYËΩ¥ÊóãËΩ¨ËßíÂ∫¶
            const targetYRotation = (targetTheta * (180 / Math.PI)) + 90;
            
            // ÁõÆÊ†áXËΩ¥ÊóãËΩ¨ËßíÂ∫¶ËÆæ‰∏∫0Ôºå‰øùÊåÅËµ§ÈÅìËßÜËßí
            const targetXRotation = 0;
            
            // ËÆ°ÁÆóËßíÂ∫¶Â∑Æ
            const yDiff = targetYRotation - sceneRotation.y;
            const xDiff = targetXRotation - sceneRotation.x;
            
            // Â§ÑÁêÜYËΩ¥ËßíÂ∫¶Ë∑®Ë∂äÈóÆÈ¢ò
            let normalizedYDiff = yDiff;
            while (normalizedYDiff > 180) normalizedYDiff -= 360;
            while (normalizedYDiff < -180) normalizedYDiff += 360;
            
            // Â∫îÁî®ÊóãËΩ¨
            sceneRotation.y += normalizedYDiff;
            sceneRotation.x = targetXRotation; // Áõ¥Êé•Â∞ÜXËΩ¥ÊóãËΩ¨ËÆæÁΩÆ‰∏∫ÁõÆÊ†áÂÄº (0)
            
            // ËÆæÁΩÆÂπ≥ÊªëÂä®Áîª
            sceneVelocity.y = normalizedYDiff * 0.3;
            sceneVelocity.x = 0; // Â∞ÜXËΩ¥ÈÄüÂ∫¶ËÆæÁΩÆ‰∏∫0ÔºåÈò≤Ê≠¢ÂêéÁª≠ÊôÉÂä®
            
            // Êõ¥Êñ∞ÂΩìÂâç‰∏≠ÂøÉÁ¥¢Âºï
            currentCenterIndex = targetIndex;
            updateThumbnailStates();
            
            console.log(`Âç°Áâá ${targetIndex} Â∑≤Â±Ö‰∏≠Âà∞Ëµ§ÈÅìËßÜËßíÔºåYËΩ¥ÊóãËΩ¨: ${targetYRotation.toFixed(1)}¬∞ÔºåXËΩ¥ÈáçÁΩÆ‰∏∫0¬∞`);
        }

        let isOutlinePanelOpen = false; // Êñ∞Â¢ûÁä∂ÊÄÅÂèòÈáè

        function toggleOutlinePanel() {
            const thumbnailContainer = document.getElementById('thumbnailContainer');
            const prevArrow = document.getElementById('prevArrow');
            const nextArrow = document.getElementById('nextArrow');
            const outlinePanel = document.getElementById('outlinePanel');
            const outlineToggle = document.getElementById('outlineToggle');

            if (isOutlinePanelOpen) {
                // ÂÖ≥Èó≠Â§ßÁ∫≤Èù¢Êùø
                outlinePanel.classList.remove('active');
                
                // Âª∂ËøüÊòæÁ§∫Áº©Áï•ÂõæÔºåËÆ©Â§ßÁ∫≤Èù¢ÊùøÂÖàÊî∂Áº©
                setTimeout(() => {
                    showThumbnailsWithAnimation();
                    prevArrow.style.opacity = '1';
                    prevArrow.style.pointerEvents = 'auto';
                    nextArrow.style.opacity = '1';
                    nextArrow.style.pointerEvents = 'auto';
                    thumbnailContainer.style.pointerEvents = 'auto';
                }, 200);

            } else {
                // ÈöêËóèÁº©Áï•Âõæ
                hideThumbnailsWithAnimation();
                
                // Âª∂ËøüÊòæÁ§∫Â§ßÁ∫≤Èù¢Êùø
                setTimeout(() => {
                    populateOutline();
                    const toggleRect = outlineToggle.getBoundingClientRect();
                    outlinePanel.style.left = `${toggleRect.left}px`;
                    outlinePanel.style.bottom = `${window.innerHeight - toggleRect.top}px`;
                    outlinePanel.classList.add('active');
                }, 300);
                
                prevArrow.style.opacity = '0';
                prevArrow.style.pointerEvents = 'none';
                nextArrow.style.opacity = '0';
                nextArrow.style.pointerEvents = 'none';
                thumbnailContainer.style.pointerEvents = 'none';
            }
            isOutlinePanelOpen = !isOutlinePanelOpen;
        }

        function hideThumbnailsWithAnimation() {
            const thumbnailCards = document.querySelectorAll('.thumbnail-card');
            thumbnailCards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('slide-out');
                }, index * 50); // ÊØè‰∏™Âç°ÁâáÂª∂Ëøü50ms
            });
        }

        function showThumbnailsWithAnimation() {
            const thumbnailCards = document.querySelectorAll('.thumbnail-card');
            
            // È¶ñÂÖàÁßªÈô§ÊâÄÊúâÂä®ÁîªÁ±ªÂπ∂ÈáçÁΩÆÁä∂ÊÄÅ
            thumbnailCards.forEach(card => {
                card.classList.remove('slide-out', 'slide-in');
                card.style.opacity = '0';
                card.style.transform = 'translateX(-60px) scale(0.8)';
            });
            
            // ÈÄê‰∏™ÊòæÁ§∫Áº©Áï•Âõæ
            thumbnailCards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('slide-in');
                    card.style.opacity = '';
                    card.style.transform = '';
                }, index * 80); // ÊØè‰∏™Âç°ÁâáÂª∂Ëøü80msÔºåÊõ¥ÊÖ¢Êõ¥‰ºòÈõÖ
            });
            
            // Ê∏ÖÁêÜÂä®ÁîªÁ±ª
            setTimeout(() => {
                thumbnailCards.forEach(card => {
                    card.classList.remove('slide-in');
                });
            }, thumbnailCards.length * 80 + 500);
        }

        function populateOutline() {
            const outlineList = document.getElementById('outlineList');
            outlineList.innerHTML = ''; // Ê∏ÖÁ©∫Áé∞ÊúâÂàóË°®

            contentTemplates.forEach((template, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'outline-list-item';
                listItem.textContent = template.title;
                listItem.dataset.index = index; // Â≠òÂÇ®Âç°ÁâáÁ¥¢Âºï

                listItem.addEventListener('click', () => {
                    centerCardToEquator(index); // ÂØºËà™Âà∞ÂØπÂ∫îÂç°Áâá
                    toggleOutlinePanel(); // ÂÖ≥Èó≠Â§ßÁ∫≤Èù¢Êùø
                });
                outlineList.appendChild(listItem);
            });
        }

        function recalculateLayout() {
            // Function remains unchanged
            windows.forEach((win, i) => {
                const newPos = calculateOriginalPosition(i);
                win.originalX = newPos.x;
                win.originalY = newPos.y;
                win.originalZ = newPos.z;
            });
        }
        
        // ÊöÇÊó∂Ê≥®ÈáäÊéâÂæÑÂêëËèúÂçïÊòæÁ§∫ÈöêËóèÂáΩÊï∞ - 2024Âπ¥Êõ¥Êñ∞
        /*
        function showRadialMenu(winState, event) { if (!winState || !winState.radialMenu) return; const rect = winState.el.getBoundingClientRect(); const x = event.clientX - rect.left; const y = event.clientY - rect.top; const menu = winState.radialMenu; menu.style.left = `${x}px`; menu.style.top = `${y}px`; menu.style.transform = `translate(-50%, -50%)`; menu.classList.add('active'); activeMenuWindow = winState; }
        function hideRadialMenu() { if (!activeMenuWindow || !activeMenuWindow.radialMenu) return; activeMenuWindow.radialMenu.classList.remove('active'); activeMenuWindow = null; }
        */
        function onMarkerClick(e) { if (!e.target.classList.contains('marker-dot')) return; e.stopPropagation(); const marker = e.target; const color = marker.dataset.color; const windowEl = marker.closest('.fui-window'); const winState = windows.find(w => w.el === windowEl); if (!color || !winState) return; const highlightClass = `highlight-${color}`; const isAlreadyHighlighted = windowEl.classList.contains(highlightClass); windowEl.classList.remove('highlight-pink', 'highlight-blue', 'highlight-yellow'); winState.highlightColor = null; if (!isAlreadyHighlighted) { windowEl.classList.add(highlightClass); winState.highlightColor = color; } }
        // =================================================================
        // üéÆ EVENT HANDLERS - ‰∫ã‰ª∂Â§ÑÁêÜÂáΩÊï∞
        // =================================================================
        // ËØ¥ÊòéÔºöËøô‰∫õÂáΩÊï∞Â§ÑÁêÜÁî®Êà∑‰∫§‰∫í‰∫ã‰ª∂ÔºàÈº†Ê†á„ÄÅÈîÆÁõò„ÄÅËß¶Êë∏Á≠âÔºâ
        // ‚ùå ‰∏çÂª∫ËÆÆ‰øÆÊîπÔºöËøô‰∫õÊòØ‰∫§‰∫íÈÄªËæëÁöÑÊ†∏ÂøÉÔºå‰øÆÊîπÂèØËÉΩÂΩ±ÂìçÁî®Êà∑‰ΩìÈ™å
        // =================================================================
        
        function onMouseDown(e) { 
            if (e.target.closest('.controls-panel') || 
                // e.target.closest('.radial-menu-item') ||   // ÊöÇÊó∂Ê≥®ÈáäÊéâÂæÑÂêëËèúÂçïÊ£ÄÊµã - 2024Âπ¥Êõ¥Êñ∞
                e.target.classList.contains('marker-dot')) return; 
            
            // ÊöÇÊó∂Ê≥®ÈáäÊéâÂæÑÂêëËèúÂçïÈöêËóèÈÄªËæë - 2024Âπ¥Êõ¥Êñ∞
            // if(activeMenuWindow){ hideRadialMenu(); return; } 
            
            const targetWindowEl = e.target.closest('.fui-window'); 
            lastMouse.x = e.clientX; 
            lastMouse.y = e.clientY; 
            startDragPos = { x: e.clientX, y: e.clientY }; 
            
            if (e.target.classList.contains('resize-handle') && targetWindowEl) { 
                isResizing = true; 
                resizingWindow = windows.find(w => w.id === targetWindowEl.id); 
                document.body.style.cursor = 'se-resize'; 
            } else if (targetWindowEl) { 
                // ÊöÇÊó∂Ê≥®ÈáäÊéâÈïøÊåâÊ£ÄÊµãÂíåÂæÑÂêëËèúÂçïÈÄªËæëÔºåÊîπ‰∏∫Áõ¥Êé•ÂêØÂä®Âú∫ÊôØÊóãËΩ¨ - 2024Âπ¥Êõ¥Êñ∞
                // ÂÖÅËÆ∏Âú®Âç°Áâá‰∏ä‰πüËÉΩÊãñÊãΩÊóãËΩ¨ÁïåÈù¢
                isRotatingScene = true; 
                document.body.style.cursor = 'grabbing'; 
                sceneVelocity.x = sceneVelocity.y = 0; 
            } else { 
                isRotatingScene = true; 
                document.body.style.cursor = 'grabbing'; 
                sceneVelocity.x = sceneVelocity.y = 0; 
            } 
        }
        function onMouseMove(e) { 
            const dx = e.clientX - lastMouse.x; 
            const dy = e.clientY - lastMouse.y; 
            const moveDist = Math.hypot(e.clientX - startDragPos.x, e.clientY - startDragPos.y); 
            
            // ÊöÇÊó∂Ê≥®ÈáäÊéâÈïøÊåâÊ£ÄÊµãÈÄªËæë - 2024Âπ¥Êõ¥Êñ∞
            // if (longPressTimer && moveDist > 5) { 
            //     clearTimeout(longPressTimer); 
            //     longPressTimer = null; 
            //     isRotatingScene = true; 
            //     document.body.style.cursor = 'grabbing'; 
            // } 
            
            if (isResizing && resizingWindow) { 
                resizingWindow.width += dx; 
                resizingWindow.height += dy; 
            } else if (isRotatingScene) { 
                sceneRotation.y += dx * rotationFactor; 
                sceneRotation.x -= dy * rotationFactor; 
                sceneVelocity.y = dx * rotationFactor; 
                sceneVelocity.x = -dy * rotationFactor; 
            } 
            lastMouse.x = e.clientX; 
            lastMouse.y = e.clientY; 
        }
        function onMouseUp(e) { 
            // ÊöÇÊó∂Ê≥®ÈáäÊéâÈïøÊåâÊ£ÄÊµãÊ∏ÖÈô§ÈÄªËæë - 2024Âπ¥Êõ¥Êñ∞
            // clearTimeout(longPressTimer); 
            // longPressTimer = null;
            
            if (isRotatingScene || isResizing) { 
                isRotatingScene = false; 
                isResizing = false; 
                resizingWindow = null; 
                document.body.style.cursor = 'grab'; 
                console.log('Èº†Ê†áÊùæÂºÄÔºåÈáçÁΩÆÊóãËΩ¨Áä∂ÊÄÅ');
            } 
        }
        // ÈîÆÁõòÂØºËà™Èò≤Êäñ
        let lastKeyPressTime = 0;
        const keyPressThreshold = 200; // ÊØ´Áßí

        function onKeyDown(e) { 
            const rotationVelocityStep = 2; 
            const currentTime = Date.now();
            
            // Â¶ÇÊûúÊúâËÅöÁÑ¶ÁöÑÁ™óÂè£ÔºåÊñπÂêëÈîÆÊéßÂà∂ÂÖ∂ÂÜÖÂÆπÊªöÂä®
            if (focusedWindow) {
                const contentEl = focusedWindow.el.querySelector('.fui-content');
                if (contentEl && (e.key === 'ArrowUp' || e.key === 'ArrowDown')) {
                    const scrollAmount = e.key === 'ArrowUp' ? -50 : 50;
                    contentEl.scrollTop += scrollAmount;
                    return;
                }
            }
            
            // Âç°ÁâáÂØºËà™ÊéßÂà∂Ôºà‰ºòÂåñÂìçÂ∫îÊÄßÔºâ
            if (e.key === 'ArrowLeft') {
                e.preventDefault();
                console.log('ÈîÆÁõòÔºöÂ∑¶ÁÆ≠Â§¥ÈîÆÊåâ‰∏ã');
                
                // Èò≤ÊäñÂ§ÑÁêÜÔºå‰ΩÜÂÖÅËÆ∏Êõ¥È¢ëÁπÅÁöÑÊìç‰Ωú
                if (currentTime - lastKeyPressTime > keyPressThreshold) {
                    lastKeyPressTime = currentTime;
                    // Â¶ÇÊûúÊ≠£Âú®ÊóãËΩ¨ÔºåÂº∫Âà∂ÂÆåÊàêÂΩìÂâçÊóãËΩ¨
                    if (isRotating) {
                        isRotating = false;
                        rotationTargetIndex = -1;
                        updateNavigationState();
                        console.log('Âº∫Âà∂ÂÆåÊàêÂΩìÂâçÊóãËΩ¨ÔºåÁ´ãÂç≥ÂìçÂ∫îÈîÆÁõò');
                    }
                    navigatePrevious();
                } else {
                    console.log('ÈîÆÁõòÊìç‰ΩúËøáÂø´ÔºåË∑≥Ëøá');
                }
                return;
            } else if (e.key === 'ArrowRight') {
                e.preventDefault();
                console.log('ÈîÆÁõòÔºöÂè≥ÁÆ≠Â§¥ÈîÆÊåâ‰∏ã');
                
                // Èò≤ÊäñÂ§ÑÁêÜÔºå‰ΩÜÂÖÅËÆ∏Êõ¥È¢ëÁπÅÁöÑÊìç‰Ωú
                if (currentTime - lastKeyPressTime > keyPressThreshold) {
                    lastKeyPressTime = currentTime;
                    // Â¶ÇÊûúÊ≠£Âú®ÊóãËΩ¨ÔºåÂº∫Âà∂ÂÆåÊàêÂΩìÂâçÊóãËΩ¨
                    if (isRotating) {
                        isRotating = false;
                        rotationTargetIndex = -1;
                        updateNavigationState();
                        console.log('Âº∫Âà∂ÂÆåÊàêÂΩìÂâçÊóãËΩ¨ÔºåÁ´ãÂç≥ÂìçÂ∫îÈîÆÁõò');
                    }
                    navigateNext();
                } else {
                    console.log('ÈîÆÁõòÊìç‰ΩúËøáÂø´ÔºåË∑≥Ëøá');
                }
                return;
            }
            
            // Âú∫ÊôØÊóãËΩ¨ÊéßÂà∂Ôºà‰ªÖ‰∏ä‰∏ãÈîÆÔºâ
            if (e.key === 'ArrowUp') sceneVelocity.x += rotationVelocityStep; 
            else if (e.key === 'ArrowDown') sceneVelocity.x -= rotationVelocityStep; 
        }
        function onDoubleClick(e) { 
            if (e.target.closest('.controls-panel') || 
                // e.target.closest('.radial-menu-item') ||   // ÊöÇÊó∂Ê≥®ÈáäÊéâÂæÑÂêëËèúÂçïÊ£ÄÊµã - 2024Âπ¥Êõ¥Êñ∞
                e.target.classList.contains('marker-dot')) return; 
            
            // ÊöÇÊó∂Ê≥®ÈáäÊéâÂæÑÂêëËèúÂçïÊ£ÄÊü• - 2024Âπ¥Êõ¥Êñ∞
            // if (activeMenuWindow) return; 
            
            // Á°Æ‰øùÂèåÂáªÊó∂Ê∏ÖÁêÜÊâÄÊúâÁä∂ÊÄÅ
            e.preventDefault();
            e.stopPropagation();
            // ÊöÇÊó∂Ê≥®ÈáäÊéâÈïøÊåâÊ£ÄÊµãÊ∏ÖÈô§ - 2024Âπ¥Êõ¥Êñ∞
            // clearTimeout(longPressTimer);
            // longPressTimer = null;
            isRotatingScene = false;
            isResizing = false;
            document.body.style.cursor = 'grab';
            
            const clickedWindowEl = e.target.closest('.fui-window'); 
            if (clickedWindowEl && !e.target.classList.contains('resize-handle')) { 
                toggleFocus(windows.find(w => w.id === clickedWindowEl.id)); 
            } else if (!clickedWindowEl && focusedWindow) { 
                toggleFocus(focusedWindow); 
            } 
        }
        function toggleFocus(win) { 
            if (!win) return; 
            
            // ÈáçÁΩÆÊâÄÊúâÈº†Ê†áÂíåÊóãËΩ¨Áä∂ÊÄÅ
            sceneVelocity.x = sceneVelocity.y = 0; 
            isRotatingScene = false;
            isResizing = false;
            resizingWindow = null;
            document.body.style.cursor = 'grab';
            
            const isAlreadyFocused = focusedWindow === win; 
            
            if (focusedWindow) { 
                const winToUnfocus = focusedWindow; 
                winToUnfocus.el.classList.remove('focused'); 
                winToUnfocus.targetScale = 1.0; 
                winToUnfocus.isFocusing = true; 
            } 
            
            if (!isAlreadyFocused) { 
                focusedWindow = win; 
                win.el.classList.add('focused'); 
                win.targetScale = 1.3; 
                win.targetX = 0; 
                win.targetY = 0; 
                win.targetZ = 1000; 
                win.isFocusing = true; 
            } else { 
                focusedWindow = null; 
            }
            
            console.log(`ÂàáÊç¢ËÅöÁÑ¶Áä∂ÊÄÅ: ${isAlreadyFocused ? 'ÂèñÊ∂àËÅöÁÑ¶' : 'ËÅöÁÑ¶'}, isRotatingScene: ${isRotatingScene}`);
        }
        function onWheel(e) { 
            e.preventDefault(); 
            
            // Â¶ÇÊûúÂ§ßÁ∫≤Èù¢ÊùøÊâìÂºÄÔºåÊªöÂä®Â§ßÁ∫≤ÂÜÖÂÆπ
            if (isOutlinePanelOpen) {
                const outlineList = document.getElementById('outlineList');
                if (outlineList) {
                    outlineList.scrollTop += e.deltaY * 0.5;
                    return; // ÈòªÊ≠¢Âú∫ÊôØÊóãËΩ¨
                }
            }

            // Â¶ÇÊûúÊúâËÅöÁÑ¶ÁöÑÁ™óÂè£Ôºå‰ºòÂÖàÊéßÂà∂ÂÖ∂ÂÜÖÂÆπÊªöÂä®
            if (focusedWindow) {
                const contentEl = focusedWindow.el.querySelector('.fui-content');
                if (contentEl) {
                    // ÊéßÂà∂ËÅöÁÑ¶Á™óÂè£ÁöÑÂÜÖÂÆπÊªöÂä®
                    const scrollAmount = e.deltaY * 0.5;
                    contentEl.scrollTop += scrollAmount;
                    return; // ‰∏çÊâßË°åÂú∫ÊôØÊóãËΩ¨
                }
            }
            
            // ‰∫§Êç¢ÊªöËΩÆÊéßÂà∂Ôºö‰∏ä‰∏ãÊªöËΩÆÊéßÂà∂Â∑¶Âè≥ÊóãËΩ¨ÔºåÂ∑¶Âè≥ÊªöËΩÆÊéßÂà∂‰∏ä‰∏ãÊóãËΩ¨
            const wheelRotationFactor = 0.2; 
            sceneVelocity.y += e.deltaY * wheelRotationFactor;  // ‰∏ä‰∏ãÊªöËΩÆÊéßÂà∂Â∑¶Âè≥ÊóãËΩ¨
            sceneVelocity.x -= e.deltaX * wheelRotationFactor;  // Â∑¶Âè≥ÊªöËΩÆÊéßÂà∂‰∏ä‰∏ãÊóãËΩ¨
        }
        
        // Other functions (updateWindowTransform, rotatePoint) remain unchanged
        function updateWindowTransform(winState) { const { el, x, y, z, scale, width, height } = winState; el.style.width = `${width}px`; el.style.height = `${height}px`; const contentEl = el.querySelector('.fui-content'); if (contentEl) contentEl.style.maxHeight = `${height - 60}px`; el.style.transform = `translateX(${-width/2}px) translateY(${-height/2}px) translate3d(${x}px, ${y}px, ${z}px) scale(${scale})`;}
        function rotatePoint(point, rotation) { const radX = rotation.x * (Math.PI / 180), radY = rotation.y * (Math.PI / 180); const sinX = Math.sin(radX), cosX = Math.cos(radX); const sinY = Math.sin(radY), cosY = Math.cos(radY); const { x, y, z } = point; const x1 = x * cosY + z * sinY; const z1 = -x * sinY + z * cosY; const y2 = y * cosX - z1 * sinX; const z2 = y * sinX + z1 * cosX; return { x: x1, y: y2, z: z2 };}



        // =================================================================
        // üé¨ ANIMATION & RENDER LOOP - Âä®ÁîªÂíåÊ∏≤ÊüìÂæ™ÁéØ
        // =================================================================
        // ËØ¥ÊòéÔºöËøô‰∫õÂáΩÊï∞Ë¥üË¥£Âä®ÁîªÊõ¥Êñ∞ÂíåÊ∏≤ÊüìÈÄªËæë
        // ‚ùå ‰∏çÂª∫ËÆÆ‰øÆÊîπÔºöËøôÊòØÊÄßËÉΩÂÖ≥ÈîÆÁöÑÊ∏≤ÊüìÈÄªËæë
        // =================================================================
        
        function animationLoop() {
            // ÊöÇÊó∂Ê≥®ÈáäÊéâÂæÑÂêëËèúÂçïÂíåÈïøÊåâÊ£ÄÊµãÁä∂ÊÄÅ - 2024Âπ¥Êõ¥Êñ∞
            if (!isRotatingScene /* && !longPressTimer && !activeMenuWindow */) {
                sceneRotation.x += sceneVelocity.x;
                sceneRotation.y += sceneVelocity.y;
                sceneVelocity.x *= damping;
                sceneVelocity.y *= damping;
            }
            sceneRotation.x = Math.max(-85, Math.min(85, sceneRotation.x));
            sceneScale += (targetScale - sceneScale) * 0.1;
            origin.style.transform = `scale(${sceneScale})`;
            
            // Êõ¥Êñ∞ÂØºËà™ÁêÉÁöÑÊóãËΩ¨
            updateNavGlobeRotation();
            
            windows.forEach(win => {
                const isUrgent = win.isFocusing;
                const currentSpringFactor = isUrgent ? focusSpringFactor : springFactor;
                const currentSpringDamping = isUrgent ? focusSpringDamping : springDamping;
                const currentScaleSpeed = isUrgent ? focusScaleSpeed : 0.1;

                if (win !== focusedWindow) {
                    const rotatedPos = rotatePoint({x: win.originalX, y: win.originalY, z: win.originalZ}, sceneRotation);
                    win.targetX = rotatedPos.x;
                    win.targetY = rotatedPos.y;
                    win.targetZ = focusedWindow ? rotatedPos.z - 2000 : rotatedPos.z;
                }
                
                if (isUrgent) {
                    const distSq = Math.hypot(win.targetX - win.x, win.targetY - win.y, win.targetZ - win.z);
                    if (distSq < 1) {
                        win.isFocusing = false;
                        win.x = win.targetX; win.y = win.targetY; win.z = win.targetZ;
                        win.scale = win.targetScale;
                        win.vx = win.vy = win.vz = 0;
                    }
                }

                win.vx = (win.vx + (win.targetX - win.x) * currentSpringFactor) * currentSpringDamping;
                win.vy = (win.vy + (win.targetY - win.y) * currentSpringFactor) * currentSpringDamping;
                win.vz = (win.vz + (win.targetZ - win.z) * currentSpringFactor) * currentSpringDamping;
                win.scale += (win.targetScale - win.scale) * currentScaleSpeed;

                win.x += win.vx; win.y += win.vy; win.z += win.vz;
                updateWindowTransform(win);
            });

            // Ê£ÄÊü•ÊóãËΩ¨ÊòØÂê¶ÂÆåÊàê
            checkRotationComplete();
            
            // Ê≥®ÊÑèÔºö‰∏ç‰ΩøÁî®Ëá™Âä®‰∏≠ÂøÉÊ£ÄÊµãÔºåÊîπ‰∏∫ÊâãÂä®ËÆæÁΩÆÈÅøÂÖçÂÜ≤Á™Å

            requestAnimationFrame(animationLoop);
        }

        // =================================================================
        // üîÑ CONTENT UPDATE FUNCTION - ÂÜÖÂÆπÊõ¥Êñ∞ÂáΩÊï∞
        // =================================================================
        // ËØ¥ÊòéÔºöËøô‰∏™ÂáΩÊï∞Ë¥üË¥£Êõ¥Êñ∞Âç°ÁâáÂÜÖÂÆπ
        // ‚ùå ‰∏çÂª∫ËÆÆ‰øÆÊîπÂáΩÊï∞ÈÄªËæëÔºöËøôÊòØÂÜÖÂÆπÊ∏≤ÊüìÁöÑÊ†∏ÂøÉ
        // üìù ÂÜÖÂÆπÊù•Ê∫êÔºö‰ªé contentTemplates Êï∞ÁªÑËé∑ÂèñÂÜÖÂÆπ
        // =================================================================
        
        function updateContent(winState) {
            const index = windows.findIndex(w => w.id === winState.id);
            if(index === -1) return;

            const template = contentTemplates[index % contentTemplates.length];
            const contentEl = winState.el.querySelector('.fui-content');
            if (template && contentEl) contentEl.innerHTML = template.content();
        }

        // =================================================================
        // üé® JARVIS Âè≥‰∏ãËßíÊïàÊûúÁ≥ªÁªü
        // =================================================================
        
        // Á≤íÂ≠êËÉåÊôØÁΩëÁªúÁ≥ªÁªü
        function initParticleBackground() {
            const canvas = document.getElementById('particleCanvas');
            const ctx = canvas.getContext('2d');
            
            // ËÆæÁΩÆcanvasÂ∞∫ÂØ∏
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            const particles = [];
            const particleCount = 100;
            const maxDistance = 150;
            let mouse = { x: null, y: null };
            
            // Á≤íÂ≠êÁ±ª
            class Particle {
                constructor() {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height;
                    this.size = Math.random() * 2 + 1;
                    this.speedX = (Math.random() - 0.5) * 0.5;
                    this.speedY = (Math.random() - 0.5) * 0.5;
                    this.opacity = Math.random() * 0.5 + 0.3;
                }
                
                update() {
                    this.x += this.speedX;
                    this.y += this.speedY;
                    
                    // ËæπÁïåÊ£ÄÊµã
                    if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
                    if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
                    
                    // Èº†Ê†á‰∫§‰∫í
                    if (mouse.x !== null && mouse.y !== null) {
                        const dx = mouse.x - this.x;
                        const dy = mouse.y - this.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < 100) {
                            const force = (100 - distance) / 100;
                            this.x -= dx * force * 0.03;
                            this.y -= dy * force * 0.03;
                        }
                    }
                }
                
                draw() {
                    ctx.save();
                    ctx.globalAlpha = this.opacity;
                    ctx.fillStyle = '#87CEEB';
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                }
            }
            
            // ÂàõÂª∫Á≤íÂ≠ê
            for (let i = 0; i < particleCount; i++) {
                particles.push(new Particle());
            }
            
            // ÁªòÂà∂ËøûÊé•Á∫ø
            function drawConnections() {
                for (let i = 0; i < particles.length; i++) {
                    for (let j = i + 1; j < particles.length; j++) {
                        const dx = particles[i].x - particles[j].x;
                        const dy = particles[i].y - particles[j].y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < maxDistance) {
                            const opacity = (1 - distance / maxDistance) * 0.3;
                            ctx.save();
                            ctx.globalAlpha = opacity;
                            ctx.strokeStyle = '#87CEEB';
                            ctx.lineWidth = 0.5;
                            ctx.beginPath();
                            ctx.moveTo(particles[i].x, particles[i].y);
                            ctx.lineTo(particles[j].x, particles[j].y);
                            ctx.stroke();
                            ctx.restore();
                        }
                    }
                }
            }
            
            // Âä®ÁîªÂæ™ÁéØ
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Êõ¥Êñ∞ÂíåÁªòÂà∂Á≤íÂ≠ê
                particles.forEach(particle => {
                    particle.update();
                    particle.draw();
                });
                
                // ÁªòÂà∂ËøûÊé•Á∫ø
                drawConnections();
                
                requestAnimationFrame(animate);
            }
            
            // Èº†Ê†á‰∫ã‰ª∂Â§ÑÁêÜ
            canvas.addEventListener('mousemove', (e) => {
                mouse.x = e.clientX;
                mouse.y = e.clientY;
            });
            
            canvas.addEventListener('mouseleave', () => {
                mouse.x = null;
                mouse.y = null;
            });
            
            // ÂêØÂä®Âä®Áîª
            animate();
        }

        // 3DÂÖâÁêÉÂä®ÁîªÁ≥ªÁªü
        function init3DSpheres() {
            const canvas = document.getElementById('cornerSphereCanvas');
            const ctx = canvas.getContext('2d');
            
            const spheres = [];
            const sphereCount = 6;
            
            // ÂàõÂª∫ÁêÉ‰Ωì
            for (let i = 0; i < sphereCount; i++) {
                spheres.push({
                    x: canvas.width / 2 + (Math.random() - 0.5) * 100,
                    y: canvas.height / 2 + (Math.random() - 0.5) * 60,
                    baseRadius: Math.random() * 15 + 10,
                    currentRadius: Math.random() * 15 + 10,
                    targetRadius: Math.random() * 15 + 10,
                    opacity: Math.random() * 0.6 + 0.2,
                    targetOpacity: Math.random() * 0.6 + 0.2,
                    color: Math.random() > 0.5 ? '#87CEEB' : '#FFD700',
                    phase: Math.random() * Math.PI * 2,
                    morphSpeed: Math.random() * 0.02 + 0.01,
                    pulsePhase: Math.random() * Math.PI * 2,
                    driftX: (Math.random() - 0.5) * 0.5,
                    driftY: (Math.random() - 0.5) * 0.3,
                    rotationSpeed: (Math.random() - 0.5) * 0.02
                });
            }
            
            function animateSpheres() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                spheres.forEach(sphere => {
                    // Êõ¥Êñ∞ÂΩ¢Âèò
                    sphere.phase += sphere.morphSpeed;
                    sphere.pulsePhase += 0.03;
                    
                    // ËÆ°ÁÆóÂΩìÂâçÂçäÂæÑÔºàÊúâÊú∫ÂèòÂΩ¢Ôºâ
                    const morphFactor = Math.sin(sphere.phase) * 0.3 + Math.cos(sphere.phase * 1.7) * 0.2;
                    sphere.currentRadius = sphere.baseRadius * (1 + morphFactor);
                    
                    // ÈÄèÊòéÂ∫¶ÂèòÂåñÔºàÁºìÊÖ¢Ê∑°ÂÖ•Ê∑°Âá∫Ôºâ
                    const pulseFactor = Math.sin(sphere.pulsePhase) * 0.3;
                    sphere.opacity = 0.4 + pulseFactor * 0.3;
                    
                    // ‰ΩçÁΩÆÊºÇÁßª
                    sphere.x += sphere.driftX;
                    sphere.y += sphere.driftY;
                    
                    // ËæπÁïåÂèçÂºπ
                    if (sphere.x < 20 || sphere.x > canvas.width - 20) sphere.driftX *= -1;
                    if (sphere.y < 15 || sphere.y > canvas.height - 15) sphere.driftY *= -1;
                    
                    // ÁªòÂà∂ÁêÉ‰ΩìÔºàÊ§≠ÂúÜÂΩ¢Áä∂Ôºâ
                    ctx.save();
                    ctx.translate(sphere.x, sphere.y);
                    ctx.scale(1, 0.7); // Ê§≠ÂúÜÂèòÂΩ¢
                    
                    // ÂàõÂª∫ÂæÑÂêëÊ∏êÂèò
                    const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, sphere.currentRadius);
                    gradient.addColorStop(0, `${sphere.color}${Math.round(sphere.opacity * 255).toString(16).padStart(2, '0')}`);
                    gradient.addColorStop(0.7, `${sphere.color}${Math.round(sphere.opacity * 100).toString(16).padStart(2, '0')}`);
                    gradient.addColorStop(1, `${sphere.color}00`);
                    
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(0, 0, sphere.currentRadius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                });
                
                requestAnimationFrame(animateSpheres);
            }
            
            animateSpheres();
        }

        // ÁßëÊäÄÂõæÊ†áÂä®ÁîªÁ≥ªÁªü
        function initCornerTechIcons() {
            const container = document.getElementById('cornerTechIcons');
            
            const techIcons = [
                '‚óâ', '‚óé', '‚¨¢', '‚¨°', '‚óà', '‚óá', '‚¨ü', '‚¨¢',
                '‚óê', '‚óë', '‚óí', '‚óì'
            ];
            
            const iconElements = [];
            const iconCount = 12;
            const centerX = 90;
            const centerY = 90;
            const radius = 75;
            
            // ÂàõÂª∫ÂõæÊ†áÂÖÉÁ¥†
            for (let i = 0; i < iconCount; i++) {
                const icon = document.createElement('div');
                icon.className = 'corner-tech-icon';
                icon.textContent = techIcons[i % techIcons.length];
                
                const angle = (i / iconCount) * Math.PI * 2 - Math.PI / 2;
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                
                icon.style.left = x + 'px';
                icon.style.top = y + 'px';
                icon.style.transform = 'translate(-50%, -50%)';
                
                container.appendChild(icon);
                iconElements.push(icon);
            }
            
            function animateIconCycle() {
                // Â±ïÂºÄÂä®Áîª
                iconElements.forEach((icon, index) => {
                    setTimeout(() => {
                        icon.classList.add('corner-animate-in');
                    }, index * 80);
                });
                
                // 2ÁßíÂêéÂºÄÂßãÊ∂àÂ§±Âä®Áîª
                setTimeout(() => {
                    iconElements.forEach((icon, index) => {
                        setTimeout(() => {
                            icon.classList.remove('corner-animate-in');
                            icon.classList.add('corner-animate-out');
                        }, index * 60);
                    });
                    
                    // Ê∂àÂ§±Âä®ÁîªÂÆåÊàêÂêéÈáçÁΩÆ
                    setTimeout(() => {
                        iconElements.forEach(icon => {
                            icon.classList.remove('corner-animate-out');
                        });
                        
                        // 1ÁßíÂêéÈáçÊñ∞ÂºÄÂßã
                        setTimeout(animateIconCycle, 1000);
                    }, iconCount * 60 + 400);
                }, 2000);
            }
            
            // ÂºÄÂßãÂä®ÁîªÂæ™ÁéØ
            setTimeout(animateIconCycle, 1000);
        }

        // =================================================================
        // üöÄ INITIALIZATION FUNCTION - ÂàùÂßãÂåñÂáΩÊï∞
        // =================================================================
        // ËØ¥ÊòéÔºöÁ≥ªÁªüÂêØÂä®ÂíåÂàùÂßãÂåñÂáΩÊï∞
        // ‚ùå ‰∏çÂª∫ËÆÆ‰øÆÊîπÔºöËøôÊòØÊ†∏ÂøÉÂàùÂßãÂåñÈÄªËæëÔºå‰øÆÊîπÂèØËÉΩÂØºËá¥Á≥ªÁªüÊó†Ê≥ïÊ≠£Â∏∏ÂêØÂä®
        // =================================================================
        
        function init() {
            // ÂàõÂª∫Âç°ÁâáÁ™óÂè£
            for (let i = 0; i < contentTemplates.length; i++) createWindow(i);
            
            // ÂàõÂª∫ÂØºËà™ÂÖÉÁ¥†
            createThumbnails();
            createNavGlobeDots();

            // ÁªëÂÆö‰∫ã‰ª∂ÁõëÂê¨Âô®
            document.addEventListener('mousedown', onMouseDown);
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
            document.addEventListener('dblclick', onDoubleClick);
            document.addEventListener('wheel', onWheel, { passive: false });
            document.addEventListener('keydown', onKeyDown);
            document.addEventListener('click', onMarkerClick);

            // ÂØºËà™ÁÆ≠Â§¥‰∫ã‰ª∂ÁõëÂê¨Âô®
            document.getElementById('prevArrow').addEventListener('click', navigatePrevious);
            document.getElementById('nextArrow').addEventListener('click', navigateNext);

            // ÊéßÂà∂Èù¢ÊùøÂàáÊç¢ÂäüËÉΩ
            const controlsPanel = document.getElementById('controls');
            const controlsToggle = document.getElementById('controlsToggle');
            controlsToggle.addEventListener('click', (e) => {
                e.stopPropagation();
                controlsPanel.classList.toggle('collapsed');
                console.log('ÊéßÂà∂Èù¢ÊùøÂàáÊç¢Áä∂ÊÄÅ:', controlsPanel.classList.contains('collapsed') ? 'Êî∂Áº©' : 'Â±ïÂºÄ');
            });

            // ÁÇπÂáªÈù¢ÊùøÂ§ñÈÉ®Êó∂Ëá™Âä®Êî∂Áº©
            document.addEventListener('click', (e) => {
                if (!controlsPanel.contains(e.target) && !controlsPanel.classList.contains('collapsed')) {
                    controlsPanel.classList.add('collapsed');
                    console.log('ÁÇπÂáªÂ§ñÈÉ®Âå∫ÂüüÔºåÊéßÂà∂Èù¢ÊùøËá™Âä®Êî∂Áº©');
                }
            });

            // ÈòªÊ≠¢ÁÇπÂáªÊéßÂà∂Èù¢ÊùøÂÜÖÈÉ®Êó∂ÂÜíÊ≥°
            controlsPanel.addEventListener('click', (e) => {
                if (!e.target.classList.contains('controls-toggle-btn') && e.target !== controlsToggle) {
                    e.stopPropagation();
                }
            });

            // Â§ßÁ∫≤ÊåâÈíÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
            const outlineToggle = document.getElementById('outlineToggle');
            const outlinePanel = document.getElementById('outlinePanel');
            const outlineList = document.getElementById('outlineList');
            const thumbnailContainer = document.getElementById('thumbnailContainer');
            const prevArrow = document.getElementById('prevArrow');
            const nextArrow = document.getElementById('nextArrow');

            outlineToggle.addEventListener('click', toggleOutlinePanel);

            // ÊéßÂà∂Èù¢ÊùøÊªëÂùó‰∫ã‰ª∂ÁõëÂê¨Âô®
            const radiusSlider = document.getElementById('radiusSlider');
            const depthSlider = document.getElementById('depthSlider');
            const scaleSlider = document.getElementById('scaleSlider');
            radiusSlider.addEventListener('input', (e) => {
                radiusFactor = parseFloat(e.target.value);
                document.getElementById('radiusValue').textContent = radiusFactor.toFixed(1);
                recalculateLayout();
                createNavGlobeDots(); // ÈáçÊñ∞ÂàõÂª∫ÂØºËà™ÁêÉÁÇπ
            });
            depthSlider.addEventListener('input', (e) => {
                ySpreadFactor = parseFloat(e.target.value);
                document.getElementById('depthValue').textContent = ySpreadFactor.toFixed(2);
                recalculateLayout();
                createNavGlobeDots(); // ÈáçÊñ∞ÂàõÂª∫ÂØºËà™ÁêÉÁÇπ
            });
            scaleSlider.addEventListener('input', (e) => {
                targetScale = parseFloat(e.target.value);
                document.getElementById('scaleValue').textContent = targetScale.toFixed(1);
            });

            // ÂêØÂä®Âä®ÁîªÂæ™ÁéØÂíåÂÜÖÂÆπÊõ¥Êñ∞
            animationLoop();
            setInterval(() => windows.forEach(updateContent), 5000); // üîÑ ÂèØ‰øÆÊîπÔºöÂÜÖÂÆπÊõ¥Êñ∞Èó¥Èöî(ÊØ´Áßí)
            
            // ÂêØÂä®JARVISÂè≥‰∏ãËßíÊïàÊûú
            initParticleBackground();
            init3DSpheres();
            initCornerTechIcons();
        }

        // =================================================================
        // üé¨ SYSTEM STARTUP - Á≥ªÁªüÂêØÂä®
        // =================================================================
        // ËØ¥ÊòéÔºöÂêØÂä®Êï¥‰∏™Á≥ªÁªü
        // ‚ùå ‰∏çË¶Å‰øÆÊîπÔºöËøôÊòØÁ≥ªÁªüÂÖ•Âè£ÁÇπ
        // =================================================================
        init();
    </script>
</body>
</html>